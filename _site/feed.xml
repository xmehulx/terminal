<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://terminal.mehulsingh.com/feed.xml" rel="self" type="application/atom+xml" /><link href="https://terminal.mehulsingh.com/" rel="alternate" type="text/html" hreflang="en" /><updated>2025-06-25T04:52:56+05:30</updated><id>https://terminal.mehulsingh.com/feed.xml</id><title type="html">Terminal Hub</title><subtitle>Articles and posts on various Unix/Linux and Windows utilites and commands for every pentester and terminal enthusiast to automate redundant tasks.</subtitle><author><name>Mehul Singh</name></author><entry><title type="html">RegreSSHion? Technical analysis of CVE-2024-6387</title><link href="https://terminal.mehulsingh.com/Regression" rel="alternate" type="text/html" title="RegreSSHion? Technical analysis of CVE-2024-6387" /><published>2024-07-03T00:00:00+05:30</published><updated>2024-07-03T00:00:00+05:30</updated><id>https://terminal.mehulsingh.com/Regression</id><content type="html" xml:base="https://terminal.mehulsingh.com/Regression"><![CDATA[<h2 id="what-is-regresshion-vulnerability">What is RegreSSHion vulnerability?</h2>

<p>On July 1, Qualys Inc published a <a href="https://www.qualys.com/2024/07/01/cve-2024-6387/regresshion.txt">security advisory</a> stating a new vulnerability in Glibc-based SSH implementation named OpenSSH, which affects 8.5p1 &lt;= OpenSSH &lt; 9.8p1 and OpenSSH &lt;= 4.4p1 versions. According to the researchers, a race condition affects the vulnerable version where, upon winning this race condition the user can execute any privileged code, remotely.</p>

<p>This was made possible due to GNU’s C library, glibc, not locking memory altering modules such as <code class="language-plaintext highlighter-rouge">malloc()</code> in the vulnerable versions, which runs with full privilege, and outside any kind of sandbox and reaching that unsafe state before the code completes its execution. The name of this CVE is due to it being an actual regressed SSH state as it was due to CVE-2006-5051, which also allowed race condition in signal handler to provide remote code execution.</p>

<p>An overview of race condition across different vulnerable versions:</p>
<ol>
  <li>OpenSSH 3.4p1 (Debian 3.0r6): Exploiting this version required interrupting a call to <code class="language-plaintext highlighter-rouge">free()</code> with <em>SIGALRM</em>, leaving the heap in an inconsistent state and exploiting this state in another call to free(). It took the researchers approximately 10,000 tries, or about one week on average, to obtain a remote root shell in this version.</li>
  <li>OpenSSH 4.2p1 (Ubuntu 6.06.1): Exploitation of this involved interrupting a call to <code class="language-plaintext highlighter-rouge">pam_start()</code> with <em>SIGALRM</em>, leading to an inconsistent state exploited in a call to pam_end(). It takes about 1-2 days to obtain a remote root shell</li>
  <li>OpenSSH 9.2p1 (Debian 12.5.0): Exploitating this involves interrupting a call to malloc() with <em>SIGALRM</em>, resulting in an inconsistent heap state exploited in another malloc() call. It took them about 6-8 hours on average to obtain a remote root shell</li>
</ol>

<h2 id="how-did-it-came-to-be">How did it came to be?</h2>

<p>We will try to understand how they did it, but from a red teaming mindset; to understand, in order to break. And even if you don’t understand C programming, don’t worry. Just understanding the general flow through function and variable names, should be enough to understand why this vulnerability exists for starter.</p>

<h3 id="timeline">Timeline</h3>

<p>On October 16 2020, the following piece of code got removed from log.c file as seen in the <a href="https://github.com/openssh/openssh-portable/commit/752250caabda3dd24635503c4cd689b32a650794">OpenSSH#752250c</a> commit. And this triggered a chain code execution which, if timed right, can allow a person to execute remote code without prior authentication.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">172</span> <span class="kt">void</span> 
<span class="mi">173</span> <span class="n">sigdie</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,...)</span>
<span class="mi">174</span> <span class="p">{</span>
<span class="mi">175</span> <span class="err">#</span><span class="n">ifdef</span> <span class="n">DO_LOG_SAFE_IN_SIGHAND</span>
<span class="mi">176</span>      <span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
<span class="mi">177</span>
<span class="mi">178</span>      <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
<span class="mi">179</span>      <span class="n">do_log</span><span class="p">(</span><span class="n">SYSLOG_LEVEL_FATAL</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
<span class="mi">180</span>      <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="mi">181</span>  <span class="err">#</span><span class="n">endif</span>
<span class="mi">182</span>      <span class="n">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="mi">183</span>  <span class="p">}</span>
</code></pre></div></div>

<p>The researchers in Qualys actually exploited the older version of OpenSSH (prior to 4.4p1) by exploiting its calling of <code class="language-plaintext highlighter-rouge">grace_alarm_handler()</code> function which waited for the <em>LoginGraceTime</em> before freeing the buffer by calling <code class="language-plaintext highlighter-rouge">free()</code> function, which is a well known unsafe asynchronous signal function. With this information, they tried to find two things or conditions which must be met to exploit the same race condition in the latest versions of OpenSSH as well:</p>
<ol>
  <li>Is there a similar function being called here which is async-signal-unsafe such as <code class="language-plaintext highlighter-rouge">malloc()</code> and <code class="language-plaintext highlighter-rouge">free()</code>?</li>
  <li>If there is, is it behind a lock?</li>
</ol>

<p>Interestingly enough, just after they started working on it, <a href="https://bugzilla.mindrot.org/show_bug.cgi?id=3690">Bugzilla #3690</a> thread got created which raised an extremely related issue, which, got marked as a duplicate by <a href="https://bugzilla.mindrot.org/show_bug.cgi?id=3598">Bugzilla #3598</a></p>

<h3 id="execution-chain-in-openssh">Execution Chain in OpenSSH</h3>

<p>In the latest versions of OpenSSH, (the last vulnerable version) the <code class="language-plaintext highlighter-rouge">grace_alarm_handler()</code> function in <code class="language-plaintext highlighter-rouge">sshd.c</code> [ultimately] calls a very interesting function called <code class="language-plaintext highlighter-rouge">syslog()</code>. Below is the complete chain of codes:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">353</span> <span class="nf">grace_alarm_handler</span><span class="p">(</span><span class="kt">int</span> <span class="n">sig</span><span class="p">)</span>
 <span class="mi">354</span> <span class="p">{</span>
 <span class="p">...</span> 
 <span class="mi">364</span>     <span class="cm">/* Log error and exit. */</span>
 <span class="mi">365</span>     <span class="n">sigdie</span><span class="p">(</span><span class="s">"Timeout before authentication for %s port %d"</span><span class="p">,</span>
 <span class="mi">366</span>         <span class="n">ssh_remote_ipaddr</span><span class="p">(</span><span class="n">the_active_state</span><span class="p">),</span>
 <span class="mi">367</span>         <span class="n">ssh_remote_port</span><span class="p">(</span><span class="n">the_active_state</span><span class="p">));</span>
 <span class="mi">368</span> <span class="err">}</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">sigdie()</code> function is a macro defined in <code class="language-plaintext highlighter-rouge">log.h</code> header file where macro expansion to <code class="language-plaintext highlighter-rouge">sshsigdie()</code> function takes place. This <code class="language-plaintext highlighter-rouge">sshsigdie()</code> function is defined in <code class="language-plaintext highlighter-rouge">log.c</code> file:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">451</span> <span class="nf">sshsigdie</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">func</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="kt">int</span> <span class="n">showfunc</span><span class="p">,</span>
<span class="mi">452</span>     <span class="n">LogLevel</span> <span class="n">level</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">suffix</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="mi">453</span> <span class="p">{</span>
<span class="p">...</span>
<span class="mi">457</span>     <span class="n">sshlogv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">showfunc</span><span class="p">,</span> <span class="n">SYSLOG_LEVEL_FATAL</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
<span class="mi">460</span>     <span class="nf">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="mi">461</span> <span class="err">}</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">sshlogv</code> is also defined in <code class="language-plaintext highlighter-rouge">log.c</code> through macro in <code class="language-plaintext highlighter-rouge">log.h</code>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">464</span> <span class="nf">sshlogv</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">func</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="kt">int</span> <span class="n">showfunc</span><span class="p">,</span>
<span class="mi">465</span>     <span class="n">LogLevel</span> <span class="n">level</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">suffix</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">args</span><span class="p">)</span>
<span class="mi">466</span> <span class="p">{</span>
<span class="p">...</span> 
<span class="mi">493</span>     <span class="n">do_log</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">forced</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">fmt2</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
<span class="mi">494</span> <span class="err">}</span>
</code></pre></div></div>

<p>And finally, this <code class="language-plaintext highlighter-rouge">do_log()</code> is what calls glibc’s native syslog() (line 419) in <code class="language-plaintext highlighter-rouge">log.c</code>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">336</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">do_log</span><span class="p">(</span><span class="n">LogLevel</span> <span class="n">level</span><span class="p">,</span> <span class="kt">int</span> <span class="n">force</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">suffix</span><span class="p">,</span>
<span class="mi">337</span>       <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">args</span><span class="p">)</span>
<span class="mi">338</span> <span class="p">{</span>
<span class="p">...</span>
<span class="mi">413</span> <span class="err">#</span><span class="k">if</span> <span class="n">defined</span><span class="p">(</span><span class="n">HAVE_OPENLOG_R</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">defined</span><span class="p">(</span><span class="n">SYSLOG_DATA_INIT</span><span class="p">)</span>
<span class="p">...</span>
<span class="mi">417</span> <span class="err">#</span><span class="k">else</span>
<span class="p">...</span>
<span class="mi">419</span>         <span class="n">syslog</span><span class="p">(</span><span class="n">pri</span><span class="p">,</span> <span class="s">"%.500s"</span><span class="p">,</span> <span class="n">fmtbuf</span><span class="p">);</span>
<span class="p">...</span>
<span class="mi">421</span> <span class="err">#</span><span class="n">endif</span>
<span class="p">...</span>
<span class="mi">424</span> <span class="err">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>Going back to our question 1, does this <code class="language-plaintext highlighter-rouge">syslog()</code> call any async-signal-unsafe? Yes! But <em>only if</em> the very first call to <code class="language-plaintext highlighter-rouge">syslog()</code> is made inside the <em>SIGALRM</em> handler, then syslog allocates a file structure and an internal read buffer through malloc</p>
  </li>
  <li>
    <p>What about the second question? Is it locked? No! Based on commit <a href="https://sourceware.org/git/?p=glibc.git;a=commit;h=3f6bb8a32e5f5efd78ac08c41e623651cc242a89">#3f6bb8a</a>, <a href="https://sourceware.org/git/?p=glibc.git;a=commit;h=a15d53e2de4c7d83bda251469d92a3c7b49a90db">#a15d53e2</a> and <a href="https://sourceware.org/git/?p=glibc.git;a=commit;h=905a7725e9157ea522d8ab97b4c8b96aeb23df54">#905a772</a> on glibc, we notice that a ‘feature’ was added to bypass locking when single-threading our application.</p>
  </li>
</ul>

<p>This guarantees that race conditions can be achieved, barring the features like NX which further attempts to prevent execution of codes in certain regions and ASLR which randomizes the address space in attept to make memory addres predictions harder. But even then, in systems like i386, some libraries like glibc is always mapped either at address 0xb7200000 or at address 0xb7400000, making their predictions right 50% of the time (more than 50% technically)</p>

<h3 id="exploiting-malloc">Exploiting Malloc</h3>

<p>Now that we know that we can run aysnc-signal-unsafe functions, the next thing is to find a control flow in <code class="language-plaintext highlighter-rouge">malloc()</code> which, when interrupted by <em>SIGALRM</em> at the right time, leaves the heap in a volatile state. If this gets possible, another signal can be made from the <em>SIGALRM</em> handler in sshd with user defined payload to be executed in a privileged state (something like a piggyback attack).</p>

<p>The researchers found numerous possible entries which might trigger this, and they went ahead with exploiting the function <code class="language-plaintext highlighter-rouge">_int_malloc()</code> which makes use of relative sizes and not absolute addresses, and this makes it better suited for amd64 exploits due to them having better ASLR capabilities. But even with this approach, their exploit worked only on i386 systems for the time being.</p>

<p>From here on out the exploit gets real technical as it deals with controlling and corrupting the heap memory with various precise function calls. The exact steps taken are better explained by the researchers themselves from here on out, and can be accessed from the security advisory linked in the introduction of this post.</p>

<h2 id="should-everyone-be-concerned">Should everyone be concerned?</h2>

<p><em>TL;DR: No*</em></p>

<p>From their report, although this attack can provide remote code execution, it takes thousands of attempts which can be logged and easily detected by modern solutions. And this by default doesn’t affect some systems such as OpenBSD which already uses async-signal-safe functions such as <code class="language-plaintext highlighter-rouge">syslog_r()</code>.</p>

<h3 id="mitigations-and-precautions">Mitigations and Precautions</h3>

<p>This vulnerability was mitigated on June 6, 2024, through commit <a href="https://github.com/openssh/openssh-portable/commit/81c1099d22b81ebfd20a334ce986c4f753b0db29">#81c1099</a> which was a part of a much bigger commit aiming at a diffense-in-depth approach which could be seen from another recent commit <a href="">#03e3de4</a> “Start the process of splitting sshd into separate binaries”. And since this might introduce difficulties in backporting, you can simply remove or comment out the async-signal-unsafe code from previously mentioned <code class="language-plaintext highlighter-rouge">sshsigdie()</code> function.</p>

<p>And in the worse case scenarios where sshd cannot be updated or recompiled, you can just set the <em>LoginGraceTime</em> to 0 in the configuration file. This will make the code vulnerable to DoS attacks but protect against possible remote code executions as mentioned in their advisory.</p>

<h2 id="further-reading">Further reading</h2>

<ol>
  <li><a href="https://lcamtuf.coredump.cx/signals.txt">Delivering Signals for Fun and Profit</a></li>
  <li><a href="https://www.openwall.com/articles/JPEG-COM-Marker-Vulnerability#exploit">JPEG COM Marker Processing Vulnerability</a></li>
  <li><a href="https://zolutal.github.io/aslrnt/">ASLRn’t: How memory alignment broke library ASLR</a></li>
</ol>]]></content><author><name>Mehul Singh</name></author><category term="SSH" /><category term="CVE" /><category term="c" /><category term="memory corruption" /><category term="race condition" /><category term="remote code execution" /><category term="aysnc-signal-unsafe" /><category term="glibc" /><summary type="html"><![CDATA[How RegreSSHion vulnerability works and are you affected by it?]]></summary></entry><entry><title type="html">Wireshark Basics - FTP Packet Analysis</title><link href="https://terminal.mehulsingh.com/wireshark-basic-tutorial-using-ftp-session" rel="alternate" type="text/html" title="Wireshark Basics - FTP Packet Analysis" /><published>2020-07-08T00:00:00+05:30</published><updated>2020-07-08T00:00:00+05:30</updated><id>https://terminal.mehulsingh.com/wireshark-basic-tutorial-using-ftp-session</id><content type="html" xml:base="https://terminal.mehulsingh.com/wireshark-basic-tutorial-using-ftp-session"><![CDATA[<h2 id="what-is-wireshark">What is Wireshark?</h2>

<p>Before anything else, know this: <strong>Wireshark is an extremely powerful tool!</strong> It allows one to see what’s happening in a network, and it does this by showing all the traffic on an interface. It literally just dumps each and every packet going across the network. Well, not <strong>just</strong> dump them but also:</p>
<ul>
  <li>Capture live packets.</li>
  <li>Import packets from text files containing hex dumps of packet data.</li>
  <li>Display detailed protocol information of each packet.</li>
  <li>Filter packets based on (multiple) criteria.</li>
  <li>Create various statistics</li>
  <li>Colourise packets for easy identification</li>
</ul>

<p>… and much more!</p>

<p>As a competent penetration tester, network security engineer or a network adminitrator, you should be well-versed with Wireshark (or any packet sniffer in general).</p>

<h2 id="getting-started">Getting started</h2>

<p>There are two ways to use Wireshark: Using the GUI or the CLI. And we are going to learn the GUI version as it is easier to learn and understand.</p>

<h3 id="prerequisites">Prerequisites</h3>

<p>There is one major requirement before getting started with any packet sniffer, which it to have a <strong>solid understanding of the TCP/IP Model</strong>, which should be pretty obvious as to why? It is because Wireshark shows packets carrying data from all the various layers from one system onto another system, which you, as an expert (or an enthusiast) are going to analyze.</p>

<h3 id="wireshark-gui">Wireshark GUI</h3>

<p>When you open Wireshark, the main screen will be divided into two broad section: “Open” and “Capture”</p>

<div class="card">
  <div class="card__image">
    <img class="image" src="/assets/images/articles/ws-if.png" alt="Interfaces recognised by Wireshark" />
    <div class="overlay">
      <p>Interfaces recognised by Wireshark</p>
    </div>
  </div>
</div>

<p>The “Open” section lets you open the previously saved captures (which will be blank if you opened wireshark the first time) and the “Capture” section lets you capture the traffic from a particular interface. You can notice that these are the same interfaces you see when you run the command <code class="language-plaintext highlighter-rouge">ip addr</code></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    <span class="nb">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp3s0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc fq_codel state DOWN group default qlen 1000
    <span class="nb">link</span>/ether d4:81:d7:ae:cc:41 brd ff:ff:ff:ff:ff:ff
3: wlp2s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    <span class="nb">link</span>/ether 3c:f8:62:f4:b2:6c brd ff:ff:ff:ff:ff:ff
    inet 192.168.43.26/24 brd 192.168.43.255 scope global dynamic noprefixroute wlp2s0
       valid_lft 2080sec preferred_lft 2080sec
    inet6 2405:204:8387:6e5b:751a:4914:e6a6:c2d9/64 scope global dynamic noprefixroute 
       valid_lft 3416sec preferred_lft 3416sec
    inet6 fe80::3a04:1960:74fe:21c5/64 scope <span class="nb">link </span>noprefixroute 
       valid_lft forever preferred_lft forever
</code></pre></div></div>

<p>The most common interfaces woulb be ‘wlan0’ for wireless connection and ‘eth0’ for ethernet connection. And if you don’t know what you are doing and just open ‘any’ interface, you’ll be overwhelmed by the amount of “noise” in the network (See the video below). In order to facilitate the analysis, we should apply <strong>capture filters</strong> and <strong>display filters</strong></p>

<video width="100%" height="100%" style="border-radius:6px;" controls="" autoplay="" muted="" loop="">
  <source src="/assets/test.mp4" type="video/mp4" />
</video>

<h2 id="filters">Filters</h2>

<p>As the name suggests, filters are a collection of strings used to filter out data (that’s the best explanation I can come up with in as little as possible)</p>

<h3 id="capture-filters">Capture Filters</h3>

<p>Capture filter are filters used to reduce the number of packets captured. As shown in the video above, Wireshark (by default) captures each and every packet flowing in the network. This might not be ideal in some situations, so we can reduce the number of packets captured by applying capture filters. You can see the capture filter box in the interface section in the first photo.</p>

<p>Some of the most simple but useful capture filters are:</p>

<ul>
  <li><strong>Filtering based on port</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tcp</span> <span class="n">port</span> <span class="mi">80</span>
</code></pre></div></div>

<p>With this filter, only http packets will be captured to and from the network.</p>

<ul>
  <li><strong>Filtering based on originating IP address(es)</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">src</span> <span class="n">net</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span>
</code></pre></div></div>
<blockquote>
  <p>We can also use subnet mask we don’t want to use CIDR notation.</p>
</blockquote>

<p>This filter helps us to capture packets originating from a whole subnet given by the CIDR notation. This could be useful when you know the malicious activity is being performed from a system in a particular subnet and you need to filter out the rest of the packets.</p>

<ul>
  <li><strong>Filtering based on host and port</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">host</span> <span class="n">www</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">port</span> <span class="mi">80</span> <span class="ow">or</span> <span class="n">port</span> <span class="mi">25</span><span class="p">)</span>
</code></pre></div></div>

<p>This is also useful if you have a server which only has a website hosted and a FTP share. So if any other port is accessed, you know something’s wrong.</p>

<h3 id="display-filters">Display Filters</h3>

<p>Display Filters are those filters which work on pre-captured packets. That is to say that they dont ‘capture’ packets based on some criteria, but rather just ‘display’ those specific packets filtered by the argument. Consider this example for a better understanding: Say that a total of 1000 packets are gonna flow for a particular activity on the network, out of which 400 packets are from IP <strong>10.0.0.1</strong> and the rest 600 are from IP <strong>10.0.0.2</strong></p>
<ul>
  <li>If we apply capture filter <code class="language-plaintext highlighter-rouge">src 10.0.0.1</code>, only 400 packets are going to be captured by the wireshark, and the rest will be discarded.</li>
  <li>But if we apply equivalent display filter <code class="language-plaintext highlighter-rouge">ip.src == 10.0.0.1</code>, all 1000 packets will be captured but only that 400 will be displayed. Once you remove this filter, all 1000 packets will be displayed again.</li>
</ul>

<p>So the equivalent display filters for the above capture filters would be:</p>

<ul>
  <li><strong>Filtering based on port</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tcp</span><span class="p">.</span><span class="n">port</span> <span class="o">==</span> <span class="mi">80</span>
</code></pre></div></div>

<ul>
  <li><strong>Filtering based on originating IP address(es)</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ip</span><span class="p">.</span><span class="n">src</span> <span class="o">==</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span>
</code></pre></div></div>

<ul>
  <li><strong>Filtering based on host and port</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ip</span><span class="p">.</span><span class="n">host</span> <span class="o">==</span> <span class="n">www</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
</code></pre></div></div>

<h2 id="ftp-packet-analysis">FTP Packet Analysis</h2>

<p>Now that the basics of Wireshark is done, let’s start with the hands-on. We will be examining a <a href="https://github.com/xmehulx/wireshark-samples/raw/master/ftp_20-21.pcap">Wireshark capture</a> between my system and a remote system with FTP service enabled. (You can download this packet capture if you want to).</p>

<p><code class="language-plaintext info highlighter-rouge">Note</code></p>
<blockquote>
  <p>This is an active FTP session (not passive) and passive FTP session would be covered later.</p>
</blockquote>

<p>The FTP session conversation was this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">ftp</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span>
<span class="n">Connected</span> <span class="n">to</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span><span class="p">.</span>
<span class="mi">220</span> <span class="p">(</span><span class="n">vsFTPd</span> <span class="mf">3.0</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span>
<span class="nc">Name </span><span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span><span class="p">:</span><span class="n">root</span><span class="p">):</span> <span class="n">ftpuser</span>
<span class="mi">331</span> <span class="n">Please</span> <span class="n">specify</span> <span class="n">the</span> <span class="n">password</span><span class="p">.</span>
<span class="n">Password</span><span class="p">:</span>
<span class="mi">230</span> <span class="n">Login</span> <span class="n">successful</span><span class="p">.</span>
<span class="n">Remote</span> <span class="n">system</span> <span class="nb">type</span> <span class="ow">is</span> <span class="n">UNIX</span><span class="p">.</span>
<span class="n">Using</span> <span class="n">binary</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">transfer</span> <span class="n">files</span><span class="p">.</span>
<span class="n">ftp</span><span class="o">&gt;</span> <span class="n">ls</span>
<span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
<span class="mi">150</span> <span class="n">Here</span> <span class="n">comes</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">listing</span><span class="p">.</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>    <span class="mi">1</span> <span class="mi">0</span>        <span class="mi">0</span>            <span class="mi">3405</span> <span class="n">Dec</span> <span class="mi">02</span>  <span class="mi">2019</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>    <span class="mi">1</span> <span class="mi">0</span>        <span class="mi">0</span>         <span class="mi">5270987</span> <span class="n">Dec</span> <span class="mi">03</span>  <span class="mi">2019</span> <span class="n">html</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
<span class="mi">226</span> <span class="n">Directory</span> <span class="n">send</span> <span class="n">OK</span><span class="p">.</span>
<span class="n">ftp</span><span class="o">&gt;</span> <span class="n">mget</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
<span class="n">mget</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="err">?</span> <span class="n">yes</span>
<span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
<span class="mi">150</span> <span class="n">Opening</span> <span class="n">BINARY</span> <span class="n">mode</span> <span class="n">data</span> <span class="n">connection</span> <span class="k">for</span> <span class="n">dump</span><span class="p">.</span><span class="nf">sql </span><span class="p">(</span><span class="mi">3405</span> <span class="nb">bytes</span><span class="p">).</span>
<span class="mi">226</span> <span class="n">Transfer</span> <span class="n">complete</span><span class="p">.</span>
<span class="mi">3405</span> <span class="nb">bytes</span> <span class="n">received</span> <span class="ow">in</span> <span class="mf">0.00</span> <span class="nf">secs </span><span class="p">(</span><span class="mf">16.1555</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>
<span class="n">ftp</span><span class="o">&gt;</span> <span class="n">quit</span>
<span class="mi">221</span> <span class="n">Goodbye</span><span class="p">.</span>
</code></pre></div></div>

<p>And the packet log is shown below</p>

<p><img src="/assets/images/articles/cap1.png" alt="Wireshark Capture" /></p>

<p>So let’s go over each and every command and see what’s happening. The client IP in this case was <strong>10.10.15.211</strong> and the FTP server was hosted on the machine with IP <strong>10.10.10.187</strong></p>

<h3 id="tcp-handshake">TCP Handshake</h3>

<p>When we type in the command <code class="language-plaintext highlighter-rouge">ftp 10.10.10.187</code> we are immediately shown the following output:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">ftp</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span>
<span class="n">Connected</span> <span class="n">to</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span><span class="p">.</span>
<span class="mi">220</span> <span class="p">(</span><span class="n">vsFTPd</span> <span class="mf">3.0</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<p>It shows “connected”, but before any TCP connection is established, a 3-way handshake was performed as it can be seen with the captured packets.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="mi">1</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64240</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745094911</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
  <span class="mi">2</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">28960</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3049545</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745094911</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
  <span class="mi">3</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745095573</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3049545</span>
  <span class="mi">4</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">72</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">220</span> <span class="p">(</span><span class="n">vsFTPd</span> <span class="mf">3.0</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span>
  <span class="mi">5</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">21</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745096034</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3049709</span>
</code></pre></div></div>

<p>The first three packets of the capture is the 3-way handhshake, highlighted with grey in Wireshark, which can be seen with the <code class="language-plaintext highlighter-rouge">tshark</code> output above. The fourth packet is the FTP banner sent by the remote server and the fifth is the acknowledgment of the previous packet. This can be summarized with the following sequence diagram.</p>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  A-&gt;&gt;F: TCP [SYN]
  F--&gt;&gt;A: TCP [SYN, ACK]
  A-&gt;&gt;F: TCP [ACK]
  Note over A,F: Connection Established
  F--&gt;&gt;A: FTP [Response: 220]
  A-&gt;&gt;F: TCP [ACK]
</code></pre>

<p>and this is the output in the terminal when the connection has been established</p>

<h3 id="login-credentials">Login Credentials</h3>

<p>When the connection has been established, The FTP asks for username and password:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Name </span><span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span><span class="p">:</span><span class="n">root</span><span class="p">):</span> <span class="n">ftpuser</span>
<span class="mi">331</span> <span class="n">Please</span> <span class="n">specify</span> <span class="n">the</span> <span class="n">password</span><span class="p">.</span>
<span class="n">Password</span><span class="p">:</span>
</code></pre></div></div>

<p>And the corresponding packets for this interaction were…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="mi">6</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">66</span> <span class="n">Request</span><span class="p">:</span> <span class="n">USER</span> <span class="n">ftpuser</span>
  <span class="mi">7</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">21</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">15</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3050418</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745098416</span>
  <span class="mi">8</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">86</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">331</span> <span class="n">Please</span> <span class="n">specify</span> <span class="n">the</span> <span class="n">password</span><span class="p">.</span>
  <span class="mi">9</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">15</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">55</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745098626</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3050418</span>
 <span class="mi">10</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">72</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PASS</span> <span class="o">%</span><span class="n">n</span><span class="err">?</span><span class="mi">4</span><span class="n">Wz</span><span class="p">}</span><span class="n">R</span><span class="err">$</span><span class="n">tTF7</span>
 <span class="mi">11</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">55</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">35</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3050972</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745100590</span>
 <span class="mi">12</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">75</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">230</span> <span class="n">Login</span> <span class="n">successful</span><span class="p">.</span>
 <span class="mi">13</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">35</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">78</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745100863</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3050978</span>
</code></pre></div></div>

<p>From the above output we can formulate the given sequence diagram for the packet flow.</p>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  A-&gt;&gt;F: FTP [Request: USER]
  F--&gt;&gt;A: TCP [ACK]
  F--&gt;&gt;A: FTP [Response: 331]
  A-&gt;&gt;F: TCP [ACK]
  A-&gt;&gt;F: FTP [Request: PASS]
  F--&gt;&gt;A: TCP [ACK]
  Note over A,F: User Authorized
  F--&gt;&gt;A: FTP [Response: 230]
  A-&gt;&gt;F: TCP [ACK]
</code></pre>

<p>And once authorized, our system issued a <code class="language-plaintext highlighter-rouge">SYST</code> command to ask the system type of the remote server.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Remote</span> <span class="n">system</span> <span class="nb">type</span> <span class="ow">is</span> <span class="n">UNIX</span><span class="p">.</span>
<span class="n">Using</span> <span class="n">binary</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">transfer</span> <span class="n">files</span><span class="p">.</span>
</code></pre></div></div>

<p>We couldn’t have known this if we didn’t see the packets being transferred, and the packets that gave this output were:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">14</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">58</span> <span class="n">Request</span><span class="p">:</span> <span class="n">SYST</span>
 <span class="mi">15</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">78</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">41</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051023</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745100864</span>
 <span class="mi">16</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">71</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">215</span> <span class="n">UNIX</span> <span class="n">Type</span><span class="p">:</span> <span class="n">L8</span>
 <span class="mi">17</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">41</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">97</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745101404</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051023</span>
</code></pre></div></div>

<p>To represent it in a sequence diagram…</p>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  A-&gt;&gt;F: FTP [Request: SYST]
  F--&gt;&gt;A: TCP [ACK]
  F--&gt;&gt;A: FTP [Response: 215]
  A-&gt;&gt;F: TCP [ACK]
</code></pre>

<h3 id="directory-listing">Directory Listing</h3>

<p>After being authorized, I performed the simplest command, that is <code class="language-plaintext highlighter-rouge">ls</code> which gave the following output:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ftp</span><span class="o">&gt;</span> <span class="n">ls</span>
<span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
<span class="mi">150</span> <span class="n">Here</span> <span class="n">comes</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">listing</span><span class="p">.</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>    <span class="mi">1</span> <span class="mi">0</span>        <span class="mi">0</span>            <span class="mi">3405</span> <span class="n">Dec</span> <span class="mi">02</span>  <span class="mi">2019</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>    <span class="mi">1</span> <span class="mi">0</span>        <span class="mi">0</span>         <span class="mi">5270987</span> <span class="n">Dec</span> <span class="mi">03</span>  <span class="mi">2019</span> <span class="n">html</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
<span class="mi">226</span> <span class="n">Directory</span> <span class="n">send</span> <span class="n">OK</span><span class="p">.</span>
</code></pre></div></div>

<p>Surprisingly, behind such a simple command, a series of packets are transferred:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">18</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">79</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PORT</span> <span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">158</span><span class="p">,</span><span class="mi">215</span>
 <span class="mi">19</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">103</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
 <span class="mi">20</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">68</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">148</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745103584</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051535</span>
 <span class="mi">21</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">58</span> <span class="n">Request</span><span class="p">:</span> <span class="n">LIST</span>
 <span class="mi">22</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29200</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051710</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">23</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">40663</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65160</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104034</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051710</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">24</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">148</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">74</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051721</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745103584</span>
 <span class="mi">25</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051815</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745104034</span>
 <span class="mi">26</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">91</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">150</span> <span class="n">Here</span> <span class="n">comes</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">listing</span><span class="p">.</span>
 <span class="mi">27</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">74</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">187</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104213</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051815</span>
 <span class="mi">28</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">187</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">135</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">LIST</span><span class="p">)</span>
 <span class="mi">29</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">40663</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">136</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104213</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051815</span>
 <span class="mi">30</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">136</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051815</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745104034</span>
 <span class="mi">31</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">40663</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">137</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104214</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051815</span>
 <span class="mi">32</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">76</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">226</span> <span class="n">Directory</span> <span class="n">send</span> <span class="n">OK</span><span class="p">.</span>
 <span class="mi">33</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">74</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">211</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104673</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051863</span>
 <span class="mi">34</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">137</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051863</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745104214</span>
</code></pre></div></div>

<p>So let’s go over the packets one by one:</p>
<ol>
  <li>Initially, the client issues a <code class="language-plaintext highlighter-rouge">PORT</code> command used to initiate a data connection to transfer data. The command include information on the address and port the server should use to connect back to the client. The structure of data is: <strong>PORT (x1,x2,x3,x4,p1,p2)</strong>, where the address where the server should respond to is <strong>x1.x2.x3.x4</strong> and the port should be <strong>(p1 x 256) + p2</strong>. In this case the the address is <strong>10.10.15.211</strong> and port is (158 x 256) + 215 = <strong>40663</strong>.</li>
  <li>The client then issues a <code class="language-plaintext highlighter-rouge">LIST</code> command to get the list of files and directories.</li>
  <li>Then, the server connects to the above mentioned port (usually from port 20) to initiate data tranfer.</li>
  <li>Once the data is transferred, the connection is closed to the data stream.</li>
</ol>

<p>So, to understand it better, we’ll be dividing it into two different diagrams. One, the formalities that need to be done to initiate the transfer and second, the data transfer itself.</p>

<p>First, the formalities:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">18</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">79</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PORT</span> <span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">158</span><span class="p">,</span><span class="mi">215</span>
 <span class="mi">19</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">103</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
 <span class="mi">20</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">68</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">148</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745103584</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051535</span>
 <span class="mi">21</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">58</span> <span class="n">Request</span><span class="p">:</span> <span class="n">LIST</span>
 <span class="mi">24</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">148</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">74</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051721</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745103584</span>
 <span class="mi">26</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">91</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">150</span> <span class="n">Here</span> <span class="n">comes</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">listing</span><span class="p">.</span>
 <span class="mi">27</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">74</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">187</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104213</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051815</span>
 <span class="mi">32</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">76</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">226</span> <span class="n">Directory</span> <span class="n">send</span> <span class="n">OK</span><span class="p">.</span>
 <span class="mi">33</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">74</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">211</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104673</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051863</span>
</code></pre></div></div>
<p>And its corresponding sequence diagram</p>
<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  A-&gt;&gt;F:  FTP [Request: PORT]
  F--&gt;&gt;A: FTP [Response: 200]
  A-&gt;&gt;F:  TCP [ACK]
  A-&gt;&gt;F:  FTP [Request: LIST]
  Note over A,F: Establ. connection for data tranfer
  F--&gt;&gt;A: TCP [ACK]
  F--&gt;&gt;A: FTP [Response: 150]
  A-&gt;&gt;F:  TCP [ACK]
  Note over A,F: Tranferring data between new ports
  F--&gt;&gt;A: FTP [Response: 226]
  A-&gt;&gt;F: TCP [ACK]
</code></pre>

<p>Then, the data transfer:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">22</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29200</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051710</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">23</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">40663</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65160</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104034</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051710</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">25</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051815</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745104034</span>
 <span class="mi">28</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">187</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">135</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">LIST</span><span class="p">)</span>
 <span class="mi">29</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">40663</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">136</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104213</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051815</span>
 <span class="mi">30</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">136</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051815</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745104034</span>
 <span class="mi">31</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">40663</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">137</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104214</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051815</span>
 <span class="mi">34</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">137</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051863</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745104214</span>
</code></pre></div></div>
<p>and its corresponding sequence diagram</p>
<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  F--&gt;&gt;A: TCP [SYN]
  A-&gt;&gt;F:  TCP [SYN, ACK]
  F--&gt;&gt;A: TCP [ACK]
  Note over A,F: Connection established
  F--&gt;&gt;A: FTP-DATA
  A-&gt;&gt;F:  TCP [ACK]
  F--&gt;&gt;A: TCP [FIN, ACK]
  A-&gt;&gt;F:  TCP [FIN, ACK]
  F--&gt;&gt;A: TCP [ACK]
  Note over A,F: Connection closed 
</code></pre>

<p>All this was happening just to display the contents of a folder!</p>

<p><code class="language-plaintext info highlighter-rouge">Note</code></p>
<blockquote>
  <p>From now on, I would simply be using <strong>“Connection established”</strong> and <strong>“Connection closed”</strong> for the 3-way handshake</p>
</blockquote>

<h3 id="file-download">File Download</h3>

<p>After listing the directory contents, I downloaded the file named <strong>dump.sql</strong> using the command <code class="language-plaintext highlighter-rouge">mget</code> (I know I could have used <code class="language-plaintext highlighter-rouge">get</code> but it’s a habit now to use <code class="language-plaintext highlighter-rouge">mget</code> all the time):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ftp</span><span class="o">&gt;</span> <span class="n">mget</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
<span class="n">mget</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="err">?</span> <span class="n">yes</span>
<span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
<span class="mi">150</span> <span class="n">Opening</span> <span class="n">BINARY</span> <span class="n">mode</span> <span class="n">data</span> <span class="n">connection</span> <span class="k">for</span> <span class="n">dump</span><span class="p">.</span><span class="nf">sql </span><span class="p">(</span><span class="mi">3405</span> <span class="nb">bytes</span><span class="p">).</span>
<span class="mi">226</span> <span class="n">Transfer</span> <span class="n">complete</span><span class="p">.</span>
<span class="mi">3405</span> <span class="nb">bytes</span> <span class="n">received</span> <span class="ow">in</span> <span class="mf">0.00</span> <span class="nf">secs </span><span class="p">(</span><span class="mf">16.1555</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>
</code></pre></div></div>

<p>And the corresponding packets for this were:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">35</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">79</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PORT</span> <span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">172</span><span class="p">,</span><span class="mi">161</span>                                                                                                   
 <span class="mi">36</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">211</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">101</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053605</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111165</span>                                                      
 <span class="mi">37</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">103</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>                                                                         
 <span class="mi">38</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">101</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">262</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745111393</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053605</span>                                                      
 <span class="mi">39</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">67</span> <span class="n">Request</span><span class="p">:</span> <span class="n">NLST</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>                                                                                                               
 <span class="mi">40</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29200</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053655</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>                                             
 <span class="mi">41</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">44193</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65160</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745111712</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053655</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>                         
 <span class="mi">42</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">262</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">116</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053666</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111393</span>                                                      
 <span class="mi">43</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053738</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111712</span>                                                          
 <span class="mi">44</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">91</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">150</span> <span class="n">Here</span> <span class="n">comes</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">listing</span><span class="p">.</span>                                                                                      
 <span class="mi">45</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">62</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">10</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">NLST</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span> 
 <span class="mi">46</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">44193</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">11</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112099</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053738</span>
 <span class="mi">47</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">11</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053738</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111712</span>
 <span class="mi">48</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">44193</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">12</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112099</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053738</span>
 <span class="mi">49</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">116</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">301</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112139</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053738</span>
 <span class="mi">50</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">12</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053833</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745112099</span>
 <span class="mi">51</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">76</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">226</span> <span class="n">Directory</span> <span class="n">send</span> <span class="n">OK</span><span class="p">.</span>
 <span class="mi">52</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">116</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">325</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112284</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053833</span>
 <span class="mi">53</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">60</span> <span class="n">Request</span><span class="p">:</span> <span class="n">TYPE</span> <span class="n">I</span>
 <span class="mi">54</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">325</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">124</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054339</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745114086</span>
 <span class="mi">55</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">83</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">Switching</span> <span class="n">to</span> <span class="n">Binary</span> <span class="n">mode</span><span class="p">.</span>
 <span class="mi">56</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">124</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">356</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745114308</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054339</span>
 <span class="mi">57</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">79</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PORT</span> <span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">145</span>
 <span class="mi">58</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">103</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
 <span class="mi">59</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">151</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">407</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745114486</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054383</span>
 <span class="mi">60</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">67</span> <span class="n">Request</span><span class="p">:</span> <span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
 <span class="mi">61</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29200</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054429</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">62</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65160</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115099</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054429</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">63</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">407</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">166</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054440</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745114486</span>
 <span class="mi">64</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054586</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745115099</span>
 <span class="mi">65</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">120</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">150</span> <span class="n">Opening</span> <span class="n">BINARY</span> <span class="n">mode</span> <span class="n">data</span> <span class="n">connection</span> <span class="k">for</span> <span class="n">dump</span><span class="p">.</span><span class="nf">sql </span><span class="p">(</span><span class="mi">3405</span> <span class="nb">bytes</span><span class="p">).</span>
 <span class="mi">66</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">166</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">475</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115554</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">67</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">1397</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">1345</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">68</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1346</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64128</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115555</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">69</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">1397</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">1345</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">70</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2691</span> <span class="n">Win</span><span class="o">=</span><span class="mi">63232</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115555</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">71</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">767</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">715</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">72</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">3406</span> <span class="n">Win</span><span class="o">=</span><span class="mi">62592</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115555</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">73</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">3406</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054586</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745115099</span>
 <span class="mi">74</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">3407</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64128</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115556</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">75</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">3407</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054695</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745115556</span>
 <span class="mi">76</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">76</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">226</span> <span class="n">Transfer</span> <span class="n">complete</span><span class="p">.</span>
 <span class="mi">77</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">166</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">499</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745116090</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054695</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">mget</code> command too invokes series of different commands to download a file, which are:</p>

<ol>
  <li><strong>PORT</strong> command to open new connection for data transfer to list the file name.</li>
  <li><strong>NLST</strong> command to list the file.</li>
  <li><strong>TYPE</strong> command to change the transfer type (in this case into binary).</li>
  <li><strong>PORT</strong> command again for data transfer. This time to transfer file contents.</li>
  <li><strong>RETR</strong> command to get the file contents.</li>
</ol>

<p>Let’s look at each one of them, starting from outermost:</p>

<p><strong>1. The Invoking of Requests</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">35</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">79</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PORT</span> <span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">172</span><span class="p">,</span><span class="mi">161</span>
 <span class="mi">36</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">211</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">101</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053605</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111165</span>
 <span class="mi">37</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">103</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
 <span class="mi">38</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">101</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">262</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745111393</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053605</span>
 <span class="mi">39</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">67</span> <span class="n">Request</span><span class="p">:</span> <span class="n">NLST</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
 <span class="mi">42</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">262</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">116</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053666</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111393</span>
 <span class="mi">44</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">91</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">150</span> <span class="n">Here</span> <span class="n">comes</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">listing</span><span class="p">.</span>
 <span class="mi">49</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">116</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">301</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112139</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053738</span>
 <span class="mi">51</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">76</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">226</span> <span class="n">Directory</span> <span class="n">send</span> <span class="n">OK</span><span class="p">.</span>
 <span class="mi">52</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">116</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">325</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112284</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053833</span>
 <span class="mi">53</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">60</span> <span class="n">Request</span><span class="p">:</span> <span class="n">TYPE</span> <span class="n">I</span>
 <span class="mi">54</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">325</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">124</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054339</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745114086</span>
 <span class="mi">55</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">83</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">Switching</span> <span class="n">to</span> <span class="n">Binary</span> <span class="n">mode</span><span class="p">.</span>
 <span class="mi">56</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">124</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">356</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745114308</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054339</span>
 <span class="mi">57</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">79</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PORT</span> <span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">145</span>
 <span class="mi">58</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">103</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
 <span class="mi">59</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">151</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">407</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745114486</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054383</span>
 <span class="mi">60</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">67</span> <span class="n">Request</span><span class="p">:</span> <span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
 <span class="mi">63</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">407</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">166</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054440</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745114486</span>
 <span class="mi">65</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">120</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">150</span> <span class="n">Opening</span> <span class="n">BINARY</span> <span class="n">mode</span> <span class="n">data</span> <span class="n">connection</span> <span class="k">for</span> <span class="n">dump</span><span class="p">.</span><span class="nf">sql </span><span class="p">(</span><span class="mi">3405</span> <span class="nb">bytes</span><span class="p">).</span>
 <span class="mi">66</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">166</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">475</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115554</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">76</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">76</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">226</span> <span class="n">Transfer</span> <span class="n">complete</span><span class="p">.</span>
 <span class="mi">77</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">166</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">499</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745116090</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054695</span>
</code></pre></div></div>

<p>Which could be easily understood by:</p>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  A-&gt;&gt;F: FTP [Request: PORT]
  F--&gt;&gt;A:TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 200]
  A-&gt;&gt;F: TCP [ACK]
  A-&gt;&gt;F: FTP [Request: NLST]
  Note over A,F: Connection for directory listing
  F--&gt;&gt;A:TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 150]
  Note over A,F: Transferring file list
  A-&gt;&gt;F: TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 226]
  A-&gt;&gt;F: TCP [ACK]
  A-&gt;&gt;F: FTP [Request: TYPE]
  F--&gt;&gt;A:TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 200]
  A-&gt;&gt;F: TCP [ACK]
  A-&gt;&gt;F: FTP [Request: PORT]
  F--&gt;&gt;A:TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 200]
  A-&gt;&gt;F: TCP [ACK]
  A-&gt;&gt;F: FTP [Request: RETR]
  Note over A,F: Connection for file transfer
  F--&gt;&gt;A:TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 150]
  A-&gt;&gt;F: TCP [ACK]
  Note over A,F: Transferring file content
  F--&gt;&gt;A:FTP [Response: 226]
  A-&gt;&gt;F: TCP [ACK]
</code></pre>

<ul>
  <li><strong>NLST over PORT</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">40</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29200</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053655</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">41</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">44193</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65160</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745111712</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053655</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">43</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053738</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111712</span>
 <span class="mi">45</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">62</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">10</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">NLST</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">46</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">44193</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">11</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112099</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053738</span>
 <span class="mi">47</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">11</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053738</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111712</span>
 <span class="mi">48</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">44193</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">12</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112099</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053738</span>
 <span class="mi">50</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">12</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053833</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745112099</span>
</code></pre></div></div>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  Note over A,F: Connection Established
  F--&gt;&gt;A:FTP-DATA
  A-&gt;&gt;F: TCP [ACK]
  Note over A,F: Connection Closed
</code></pre>

<ul>
  <li><strong>RETR over PORT</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">61</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29200</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054429</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">62</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65160</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115099</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054429</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">64</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054586</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745115099</span>
 <span class="mi">67</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">1397</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">1345</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">68</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1346</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64128</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115555</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">69</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">1397</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">1345</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">70</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2691</span> <span class="n">Win</span><span class="o">=</span><span class="mi">63232</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115555</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">71</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">767</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">715</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">72</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">3406</span> <span class="n">Win</span><span class="o">=</span><span class="mi">62592</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115555</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">73</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">3406</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054586</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745115099</span>
 <span class="mi">74</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">3407</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64128</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115556</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">75</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">3407</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054695</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745115556</span>
</code></pre></div></div>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  Note over A,F: Connection Established
  F--&gt;&gt;A:FTP-DATA
  A-&gt;&gt;F: TCP [ACK]
  F--&gt;&gt;A:FTP-DATA
  A-&gt;&gt;F: TCP [ACK]
  F--&gt;&gt;A:FTP-DATA
  A-&gt;&gt;F: TCP [ACK]
  Note over A,F: Connection Closed
</code></pre>

<h3 id="closing-session">Closing Session</h3>

<p>After all this, all that is left is to quit the FTP session</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ftp</span><span class="o">&gt;</span> <span class="n">quit</span>
<span class="mi">221</span> <span class="n">Goodbye</span><span class="p">.</span>
</code></pre></div></div>

<p>And the packets this command generated were:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">78</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">58</span> <span class="n">Request</span><span class="p">:</span> <span class="n">QUIT</span>
 <span class="mi">79</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">499</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">172</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3055803</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745119944</span>
 <span class="mi">80</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">66</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">221</span> <span class="n">Goodbye</span><span class="p">.</span>
 <span class="mi">81</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">172</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">513</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745120354</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3055803</span>
 <span class="mi">82</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">513</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">172</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3055803</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745119944</span>
 <span class="mi">83</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">172</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">514</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745120355</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3055803</span>
 <span class="mi">84</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">514</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">173</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3055895</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745120355</span>
</code></pre></div></div>

<p>Which should be fairly easy to understand now, after looking at all these sequence diagrams.</p>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  A-&gt;&gt;F: FTP [Request: QUIT]
  F--&gt;&gt;A:TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 221]
  A-&gt;&gt;F: TCP [ACK]
  Note over A,F: Connection Closed
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>That would be a lot to take in for a newbie, but if they have strong understanding of TCP/IP protocol and its model, this would still be quite easy to grasp. Understanding the packet structure and the working of Wireshark would make the life of a security engineer a lot easier as they would know what each and every packet is doing in their network.</p>

<!--more-->

<hr />]]></content><author><name>Mehul Singh</name></author><category term="wireshark" /><category term="beginner" /><category term="terminal" /><category term="ftp" /><category term="console" /><category term="shell" /><category term="filters" /><category term="capture filters" /><category term="display filters" /><category term="CIDR" /><category term="tshark" /><summary type="html"><![CDATA[Wireshark is the de facto network protocol analyzer and packet analysis tool. Learn how to use it by analyzing an active FTP session.]]></summary></entry><entry><title type="html">Beginner’s Guide to AWK</title><link href="https://terminal.mehulsingh.com/beginners-guide-to-awk" rel="alternate" type="text/html" title="Beginner’s Guide to AWK" /><published>2020-06-19T00:00:00+05:30</published><updated>2020-06-19T00:00:00+05:30</updated><id>https://terminal.mehulsingh.com/beginners-guide-to-awk</id><content type="html" xml:base="https://terminal.mehulsingh.com/beginners-guide-to-awk"><![CDATA[<h2 id="what-is-awk">What is AWK?</h2>

<p>Awk is basically a scripting language used for manipulating data and generating reports. It is mostly used for pattern scanning and processing. It searches one or more files to see if they contain lines that matches with the specified patterns and then performs the associated actions. Not just penetration tester but all those who work in terminal should get comfortable with this as it saves a lot of time and effort when you know what you are doing. And the best part, <strong>AWK never modifies the input file</strong>! So you can be sure your input stream is safe from any modification (unless you are performing redirections from AWK of course!)</p>

<p>So next question is, what can AWK do? Well for starters it can:</p>
<ul>
  <li>Read file line by line</li>
  <li>Find patterns in strings</li>
  <li>Compare patterns on each string</li>
  <li>Perform action(s) on those strings based on different conditions</li>
</ul>

<p>It can do much more if you delve too deep into it but I am only going to take you through the basics which would get you up and going.</p>

<h2 id="getting-started">Getting started</h2>

<h3 id="awks-workflow">AWK’s Workflow</h3>

<pre><code class="language-mermaid">graph TD;
  a(Execution starts from 'BEGIN' block) --&gt; b[Read line from input stream]
  b --&gt; c[Execute AWK command on this line]
  c --&gt;| If EOF | d[Execution ends with 'END' block]
  c --&gt;| If !EOF | b
</code></pre>

<h3 id="awk-syntax">AWK Syntax</h3>

<p>From AWK’s man page, the syntax for AWK is:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">awk</span> <span class="o">[</span>−F sepstring] <span class="o">[</span>−v assignment]... program <span class="o">[</span>argument...]
</code></pre></div></div>

<h3 id="print-a-file">Print a file</h3>

<p>To simply print a file we using AWK, the command is</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">awk</span> <span class="s1">'{print}'</span> &lt;filename&gt;
</code></pre></div></div>
<blockquote>
  <p>Note: If filename isn’t mentioned it takes input from STDIN.</p>
</blockquote>

<p>and at the first glance it does seem rather long than simply typing</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat</span> &lt;filename&gt;
</code></pre></div></div>

<p>But AWK isn’t used to simply print a file, for that obviously cat is more handy than AWK. So now let’s what makes AWK one of the most (<strong>if not the most!</strong>) preferable scripting language as well as command line utility for processing texts.</p>

<h2 id="finding-patterns">Finding patterns</h2>

<p>Let’s consider a real-life scenario for a penetration tester. You get a shell back and now want to see what all users are present with a bash access. So you look at the <strong>/etc/passwd</strong> file…</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat</span> /etc/passwd
root:x:0:0::/root:/bin/bash
nobody:x:65534:65534:Nobody:/:/usr/bin/nologin
dbus:x:81:81:System Message Bus:/:/usr/bin/nologin
...
nvidia-persistenced:x:143:143:NVIDIA Persistence Daemon:/:/usr/bin/nologin
ana:x:1005:1005:anastasia:/home/ana:/bin/bash
</code></pre></div></div>
<p>And see these many users!</p>

<h3 id="basic-word-search">Basic word search</h3>

<p>To find users with bash access we will run…</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">awk</span> <span class="s1">'/bash/ {print}'</span> /etc/passwd
root:x:0:0::/root:/bin/bash
ceb:x:1009:1009:sebastian:/home/ceb:/bin/bash
notail:x:1002:1002:sundstein:/home/notail:/bin/bash
midone:x:1000:1000:xin:/home/midone:/bin/bash
topson:x:1004:1004:topias:/home/topson:/bin/bash
ana:x:1005:1005:anastasia:/home/ana:/bin/bash
</code></pre></div></div>
<p>It matches each line which contain the word <strong>“bash”</strong></p>

<h3 id="search-using-regular-expression">Search using Regular Expression</h3>

<p>AWK even supports using <strong>regular expressions</strong> to search for patterns. Considering the previous example, if we have to search for rows that begins with <code class="language-plaintext highlighter-rouge">T</code>, is followed by indefinite number of character and then and has <code class="language-plaintext highlighter-rouge">son</code> in it, we would do:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">awk</span> <span class="s1">'/^t.*son/ {print}'</span> /etc/passwd
topson:x:1004:1004:topias:/home/topson:/bin/bash
</code></pre></div></div>

<p><strong>RegEx</strong> is an extremely powerful tool which aids in almost every domain, be it penetration testing, domain administration, database administration, network security, et cetra. I would make a seperate post about it too.</p>

<h2 id="field-splitting">Field Splitting</h2>

<h3 id="basic-field-splitting">Basic Field Splitting</h3>
<p>Another great feature of AWK is to seperate data into fields based on a <strong>delimiter</strong>. This could be done by the following command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">awk</span> <span class="nt">-F</span> &lt;delimiter&gt; &lt;file&gt;
</code></pre></div></div>

<p>This will create table like structure with each input line as a row and new column everytime the delimiter is encountered. Considering a real-life scenario, once when I was performing a pentest on a server, I came across a directory which contained around 100 folders and each folder name looked like a possible username. So I needed to extract the folder names and create a new text file with each name on a new line. So what I did was…</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">' '</span> <span class="s1">'{print $9}'</span> <span class="o">&gt;&gt;</span> users.lst
<span class="nv">$ </span><span class="nb">cat </span>users.lst
file1.name
file2.name
</code></pre></div></div>

<p>This created the required file. So how does it work? First of all, we need to know the output format of the <code class="language-plaintext highlighter-rouge">ls</code> command which is as follows:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span>
<span class="nt">-rw-r--r--</span>  1 root root     56 Jun 18 11:53 file1.name 
<span class="nt">-rw-r--r--</span>  1 root root     65 Jun 18 11:35 file2.name 
</code></pre></div></div>

<p>And here, as I have set the delimiter to be whitespace character, the AWK statement created the following table-like structure (<strong>just for understanding!</strong>)</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">$1</th>
      <th style="text-align: center">$2</th>
      <th style="text-align: center">$3</th>
      <th>$4</th>
      <th>$5</th>
      <th>$6</th>
      <th>$7</th>
      <th>$8</th>
      <th>$9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">-rw-r–r–</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">root</td>
      <td>root</td>
      <td>56</td>
      <td>Jun</td>
      <td>18</td>
      <td>11:53</td>
      <td>file1.name</td>
    </tr>
    <tr>
      <td style="text-align: center">-rw-r–r–</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">root</td>
      <td>root</td>
      <td>65</td>
      <td>Jun</td>
      <td>18</td>
      <td>11:35</td>
      <td>file2.name</td>
    </tr>
  </tbody>
</table>

<p>It should be quite clear from the above table why we chose <strong>$9</strong> for the command.</p>

<h3 id="multi-column-print">Multi-Column Print</h3>

<p>Let’s take another example. Consider a case where we want to print the users and their HOME folder. For that we can do…</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">':'</span> <span class="s1">'{print $1 " -&gt; " $6}'</span> /etc/passwd
root -&gt; /root
nobody -&gt; /
...
ana -&gt; /home/ana
</code></pre></div></div>

<h2 id="inbuilt-variables">Inbuilt Variables</h2>

<p>AWK has a numerous inbuilt variables which provide extra tool for power users. We won’t go too deep as this is just a beginner’s guide to AWK.</p>

<h3 id="argc">ARGC</h3>

<p>This variable contains the <strong>number of arguments</strong> passed to the AWK command.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">awk</span> <span class="s1">'BEGIN {print ARGC}'</span> arg1 arg2 arg3
4
</code></pre></div></div>
<blockquote>
  <p><strong>BEGIN</strong> was used here as it doesn’t require seperate input stream to run and it runs only once. Or else it would run for every line of the input stream.</p>
</blockquote>

<p>It simply returned the number of arguments passed, the first argument being the command itself.</p>

<h3 id="argv">ARGV</h3>

<p>This variable contains the <strong>list of arguments passed</strong> to the AWK command ranging from <strong>0</strong> to <strong>ARGC-1</strong>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">awk</span> <span class="s1">'BEGIN {print ARGV[0]}'</span> arg1 arg2 arg3
<span class="nb">awk</span>
<span class="nv">$ </span><span class="nb">awk</span> <span class="s1">'BEGIN {print ARGV[3]}'</span> arg1 arg2 arg3
arg3
</code></pre></div></div>

<h3 id="nr">NR</h3>

<p>NR represents <strong>Number of current Record</strong>. It could be easily understood as the line number starting from 1.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">':'</span> <span class="s1">'{print NR ":" $1 " -&gt; " $6}'</span> /etc/passwd
1:root -&gt; /root
2:nobody -&gt; /
...
31:ana -&gt; /home/ana
</code></pre></div></div>

<h3 id="environ">ENVIRON</h3>

<p>As the name suggest, it is used to access the array of <strong>environment variables</strong>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">awk</span> <span class="s1">'BEGIN {print ENVIRON["PATH"]}'</span>
/home/ana/.gem/ruby/2.7.0/bin:/home/ana/.local/bin:/home/ana/.gem/ruby/2.7.0/bin:/home/ana/.gem/ruby/2.7.0/bin:/home/ana/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/bin:/usr/lib/jvm/default/bin:/usr/bin/site_perl:/usr/bin/vendor_perl:/usr/bin/core_perl:/var/lib/snapd/snap/bin:/usr/lib/jvm/default/bin:/usr/bin/site_perl:/usr/bin/vendor_perl:/usr/bin/core_perl
</code></pre></div></div>

<h3 id="filename">FILENAME</h3>

<p>As the name suggest it prints the name of the file passed to it</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">awk</span> <span class="s1">'END {print FILENAME}'</span> /etc/passwd
/etc/passwd
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> | <span class="nb">awk</span> <span class="s1">'END {print FILENAME}'</span>
-
</code></pre></div></div>
<blockquote>
  <p>Can you think why we used <strong>END</strong> here and not <strong>BEGIN</strong>? HINT: Look at the workflow</p>
</blockquote>

<p>In the second example, since we send the STDIN into AWK, the output was <strong>-</strong> (which represents STDIN)</p>

<h3 id="fs">FS</h3>

<p>FS represents the <strong>Field Seperator</strong> whose default value is a space. We can change its value with the <strong>-F</strong> parameter as shown previously.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">awk</span> <span class="s1">'{print FS}'</span> | <span class="nb">cat</span> <span class="nt">-e</span>
 <span class="err">$</span>
</code></pre></div></div>
<p>We used <code class="language-plaintext highlighter-rouge">cat -e</code> to show the non-printable characters such as the <strong>$</strong> symbol which comes at the end of each line, without which we couldn’t have known that there is a whitespace printed.</p>

<h2 id="substitution">Substitution</h2>

<p>One other useful option provided by AWK is <strong>pattern substitution</strong>. There are numerous ways to make this happen and we are going to see the most common ones.</p>

<h3 id="changing-fs">Changing FS</h3>

<p>One of the basic task is to change the Field Seperator. To do this we run:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">awk</span> <span class="s1">'$1=$1'</span> <span class="nv">FS</span><span class="o">=</span><span class="s2">":"</span> <span class="nv">OFS</span><span class="o">=</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> /etc/passwd
root    x       0       0               /root   /bin/bash
nobody  x       65534   65534   Nobody  /       /usr/bin/nologin
...
midone  x       1005    1005    xin     /home/midone     /bin/bash
</code></pre></div></div>
<p>We used <code class="language-plaintext highlighter-rouge">'$1=$1'</code> because it forces AWK to rebuild the record because simple using <code class="language-plaintext highlighter-rouge">{print}</code> doesn’t change the record! According to the GNU’s manual…</p>

<p><code class="language-plaintext info highlighter-rouge">manual</code></p>

<blockquote>
  <p><strong>Understanding $0:</strong>
It is important to remember that <code class="language-plaintext highlighter-rouge">$0</code> is the full record, exactly as it was read from the input. This includes any leading or trailing whitespace, and the exact whitespace (or other characters) that separates the fields.
It is a common error to try to change the field separators in a record simply by setting FS and OFS, and then expecting a plain ‘print’ or ‘print <code class="language-plaintext highlighter-rouge">$0</code>’ to print the modified record.
But this does not work, because nothing was done to change the record itself. Instead, you must force the record to be rebuilt, typically with a statement such as <code class="language-plaintext highlighter-rouge">$1 = $1</code>, as described earlier.</p>
</blockquote>

<p>You can read more about it <a href="https://www.gnu.org/software/gawk/manual/html_node/Changing-Fields.html">here</a>.</p>

<h3 id="gsub">GSUB</h3>

<p>GSUB stands for <strong>global substitution</strong> and it replaces every occurrence found with another specified word. For example:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-l</span> | <span class="nb">awk</span> <span class="s1">'gsub("4096","0000")'</span>
total 56
drwxr-xr-x 2 ana ana 0000 Jun 10 17:40 Desktop
drwxr-xr-x 6 ana ana 0000 Jun 15 21:31 Documents
drwxr-xr-x 3 ana ana 0000 Jun 18 00:19 Downloads
drwxr-x--- 4 ana ana 0000 May 31 14:22 Ghidra
drwxr-x--- 2 ana ana 0000 May 30 16:39 ghidra_scripts
drwxr-xr-x 9 ana ana 0000 Jun 18 11:52 GitHub
drwxr-xr-x 9 ana ana 0000 Jun 10 12:20 HTB
drwxr-xr-x 2 ana ana 0000 May 29 00:39 logs
drwxr-xr-x 2 ana ana 0000 May 28 15:38 Music
drwxr-xr-x 2 ana ana 0000 Jun  5 14:34 Pictures
drwxr-xr-x 3 ana ana 0000 May 29 00:48 Public
drwxr-xr-x 2 ana ana 0000 May 28 06:48 Videos
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>This isn’t even the tip of the iceberg when it comes to AWK, it’s a whole scripting language in itself with which we can create loops, multi-dimensional arrays, manipulate bits, and what not! But this guide should be useful just for all those who have an interest in AWK but didn’t know where to start from, or for those who spent long duration of time to modify texts manually.</p>

<!--more-->

<hr />]]></content><author><name>Mehul Singh</name></author><category term="awk" /><category term="beginner" /><category term="terminal" /><category term="data manipulation" /><category term="scripting language" /><category term="console" /><category term="shell" /><category term="delimiter" /><category term="regular expression" /><category term="field splitting" /><category term="argc" /><category term="argv" /><category term="field seperator" /><category term="gsub" /><summary type="html"><![CDATA[Learn to process data with the all powerfull scripting language AWK]]></summary></entry></feed>