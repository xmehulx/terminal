<!DOCTYPE html><html lang="en">
  <head><!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-8G2R9MG8CJ"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-8G2R9MG8CJ');
		
	</script><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8G2R9MG8CJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-8G2R9MG8CJ');
</script>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<link rel="apple-touch-img/logo-precomposed" href="https://xmehulx.github.io/terminal/assets/android-chrome-512x512.png">
<link rel="apple-touch-img/logo" href="https://xmehulx.github.io/terminal/assets/android-chrome-512x512.png">
<link rel="apple-touch-img/logo" sizes="72x72" href="https://xmehulx.github.io/terminal/assets/mstile-70x70.png">
<link rel="apple-touch-img/logo" sizes="114x114" href="https://xmehulx.github.io/terminal/assets/mstile-144x144.png">

    <!-- Open Graphs -->
    <meta property="og:image" content="https://xmehulx.github.io/terminal/assets/android-chrome-512x512.png">
    <meta property="og:description" content="Wireshark is the de facto network protocol analyzer and packet analysis tool. Learn how to use it by analyzing an active FTP session.">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Wireshark Basics - FTP Packet Analysis">
    <meta property="og:url" content="https://terminal.mehulsingh.com/wireshark-basic-tutorial-using-ftp-session">
    <!-- Twitter cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="_xmehulx_">
    <meta name="twitter:creator" content="@_xmehulx_">
    <meta name="twitter:title" content="Wireshark Basics - FTP Packet Analysis">
    <meta name="twitter:description" content="Wireshark is the de facto network protocol analyzer and packet analysis tool. Learn how to use it by analyzing an active FTP session.">
    <meta name="twitter:image" content="https://xmehulx.github.io/terminal/assets/android-chrome-512x512.png"><title>Wireshark Basics - FTP Packet Analysis - Terminal Hub</title>

<meta name="description" content="Wireshark is the de facto network protocol analyzer and packet analysis tool. Learn how to use it by analyzing an active FTP session.">
<link rel="canonical" href="https://terminal.mehulsingh.com/wireshark-basic-tutorial-using-ftp-session"><link rel="alternate" type="application/rss+xml" title="Terminal Hub" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" ><!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://use.fontawesome.com/releases/v5.0.13/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="24px" height="24px" viewBox="0 0 24 24">
<style type="text/css">
	.st0{fill:#515151;}
</style>
<path class="st0" d="M1.7,22.3c5.7-5.7,11.3-5.7,17,0c3.3-3.3,3.5-5.3,0.8-6c2.7,0.7,3.5-1.1,2.3-5.6s-3.3-5.2-6.3-2.1
	c3-3,2.3-5.2-2.1-6.3S7,1.8,7.7,4.6C7,1.8,5,2.1,1.7,5.3C7.3,11,7.3,16.7,1.7,22.3"/>
</svg>
<a title="Articles and posts on various Unix/Linux and Windows utilites and commands for every pentester and terminal enthusiast to automate redundant tasks." href="/">Terminal Hub</a></div><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></div><nav class="navigation">
        <ul><li class="navigation__item"><a href="/archive">Archive</a></li><li class="navigation__item"><a href="https://mehulsingh.com">About</a></li><li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class="article__header--overlay"><div class="hero hero--dark overlay" style="background-image:linear-gradient(135deg, rgba(34, 139, 87 , .4), rgba(139, 34, 139, .6)),url(/assets/images/articles/wireshark-bg.png);background-color:#203028;"><div class="hero__content"><div class ="main"><div class="article__header"><header><h1>Wireshark Basics - FTP Packet Analysis</h1></header></div><p class="overlay__excerpt">Wireshark is the de facto network protocol analyzer and packet analysis tool. Learn how to use it by analyzing an active FTP session.</p><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=wireshark">wireshark</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=beginner">beginner</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=terminal">terminal</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=ftp">ftp</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=console">console</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=shell">shell</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=filters">filters</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=capture+filters">capture filters</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=display+filters">display filters</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=CIDR">CIDR</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=tshark">tshark</a>
            </li></ul><ul class="right-col menu"><li><i class="fas fa-user"></i> <span>Mehul Singh</span></li><li><i class="far fa-calendar-alt"></i> <span>Jul 08, 2020</span>
            </li></ul></div></div></div>
              </div>
            </div><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><meta itemprop="headline" content="Wireshark Basics - FTP Packet Analysis"><meta itemprop="author" content="Mehul Singh"/><meta itemprop="datePublished" content="2020-07-08T00:00:00+05:30">
    <meta itemprop="keywords" content="wireshark,beginner,terminal,ftp,console,shell,filters,capture filters,display filters,CIDR,tshark"><div class="js-article-content"><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody"><h2 id="what-is-wireshark">What is Wireshark?</h2>

<p>Before anything else, know this: <strong>Wireshark is an extremely powerful tool!</strong> It allows one to see what’s happening in a network, and it does this by showing all the traffic on an interface. It literally just dumps each and every packet going across the network. Well, not <strong>just</strong> dump them but also:</p>
<ul>
  <li>Capture live packets.</li>
  <li>Import packets from text files containing hex dumps of packet data.</li>
  <li>Display detailed protocol information of each packet.</li>
  <li>Filter packets based on (multiple) criteria.</li>
  <li>Create various statistics</li>
  <li>Colourise packets for easy identification</li>
</ul>

<p>… and much more!</p>

<p>As a competent penetration tester, network security engineer or a network adminitrator, you should be well-versed with Wireshark (or any packet sniffer in general).</p>

<h2 id="getting-started">Getting started</h2>

<p>There are two ways to use Wireshark: Using the GUI or the CLI. And we are going to learn the GUI version as it is easier to learn and understand.</p>

<h3 id="prerequisites">Prerequisites</h3>

<p>There is one major requirement before getting started with any packet sniffer, which it to have a <strong>solid understanding of the TCP/IP Model</strong>, which should be pretty obvious as to why? It is because Wireshark shows packets carrying data from all the various layers from one system onto another system, which you, as an expert (or an enthusiast) are going to analyze.</p>

<h3 id="wireshark-gui">Wireshark GUI</h3>

<p>When you open Wireshark, the main screen will be divided into two broad section: “Open” and “Capture”</p>

<div class="card">
  <div class="card__image">
    <img class="image" src="/assets/images/articles/ws-if.png" alt="Interfaces recognised by Wireshark" />
    <div class="overlay">
      <p>Interfaces recognised by Wireshark</p>
    </div>
  </div>
</div>

<p>The “Open” section lets you open the previously saved captures (which will be blank if you opened wireshark the first time) and the “Capture” section lets you capture the traffic from a particular interface. You can notice that these are the same interfaces you see when you run the command <code class="language-plaintext highlighter-rouge">ip addr</code></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    <span class="nb">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp3s0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc fq_codel state DOWN group default qlen 1000
    <span class="nb">link</span>/ether d4:81:d7:ae:cc:41 brd ff:ff:ff:ff:ff:ff
3: wlp2s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    <span class="nb">link</span>/ether 3c:f8:62:f4:b2:6c brd ff:ff:ff:ff:ff:ff
    inet 192.168.43.26/24 brd 192.168.43.255 scope global dynamic noprefixroute wlp2s0
       valid_lft 2080sec preferred_lft 2080sec
    inet6 2405:204:8387:6e5b:751a:4914:e6a6:c2d9/64 scope global dynamic noprefixroute 
       valid_lft 3416sec preferred_lft 3416sec
    inet6 fe80::3a04:1960:74fe:21c5/64 scope <span class="nb">link </span>noprefixroute 
       valid_lft forever preferred_lft forever
</code></pre></div></div>

<p>The most common interfaces woulb be ‘wlan0’ for wireless connection and ‘eth0’ for ethernet connection. And if you don’t know what you are doing and just open ‘any’ interface, you’ll be overwhelmed by the amount of “noise” in the network (See the video below). In order to facilitate the analysis, we should apply <strong>capture filters</strong> and <strong>display filters</strong></p>

<video width="100%" height="100%" style="border-radius:6px;" controls="" autoplay="" muted="" loop="">
  <source src="/assets/test.mp4" type="video/mp4" />
</video>

<h2 id="filters">Filters</h2>

<p>As the name suggests, filters are a collection of strings used to filter out data (that’s the best explanation I can come up with in as little as possible)</p>

<h3 id="capture-filters">Capture Filters</h3>

<p>Capture filter are filters used to reduce the number of packets captured. As shown in the video above, Wireshark (by default) captures each and every packet flowing in the network. This might not be ideal in some situations, so we can reduce the number of packets captured by applying capture filters. You can see the capture filter box in the interface section in the first photo.</p>

<p>Some of the most simple but useful capture filters are:</p>

<ul>
  <li><strong>Filtering based on port</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tcp</span> <span class="n">port</span> <span class="mi">80</span>
</code></pre></div></div>

<p>With this filter, only http packets will be captured to and from the network.</p>

<ul>
  <li><strong>Filtering based on originating IP address(es)</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">src</span> <span class="n">net</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span>
</code></pre></div></div>
<blockquote>
  <p>We can also use subnet mask we don’t want to use CIDR notation.</p>
</blockquote>

<p>This filter helps us to capture packets originating from a whole subnet given by the CIDR notation. This could be useful when you know the malicious activity is being performed from a system in a particular subnet and you need to filter out the rest of the packets.</p>

<ul>
  <li><strong>Filtering based on host and port</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">host</span> <span class="n">www</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">port</span> <span class="mi">80</span> <span class="ow">or</span> <span class="n">port</span> <span class="mi">25</span><span class="p">)</span>
</code></pre></div></div>

<p>This is also useful if you have a server which only has a website hosted and a FTP share. So if any other port is accessed, you know something’s wrong.</p>

<h3 id="display-filters">Display Filters</h3>

<p>Display Filters are those filters which work on pre-captured packets. That is to say that they dont ‘capture’ packets based on some criteria, but rather just ‘display’ those specific packets filtered by the argument. Consider this example for a better understanding: Say that a total of 1000 packets are gonna flow for a particular activity on the network, out of which 400 packets are from IP <strong>10.0.0.1</strong> and the rest 600 are from IP <strong>10.0.0.2</strong></p>
<ul>
  <li>If we apply capture filter <code class="language-plaintext highlighter-rouge">src 10.0.0.1</code>, only 400 packets are going to be captured by the wireshark, and the rest will be discarded.</li>
  <li>But if we apply equivalent display filter <code class="language-plaintext highlighter-rouge">ip.src == 10.0.0.1</code>, all 1000 packets will be captured but only that 400 will be displayed. Once you remove this filter, all 1000 packets will be displayed again.</li>
</ul>

<p>So the equivalent display filters for the above capture filters would be:</p>

<ul>
  <li><strong>Filtering based on port</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tcp</span><span class="p">.</span><span class="n">port</span> <span class="o">==</span> <span class="mi">80</span>
</code></pre></div></div>

<ul>
  <li><strong>Filtering based on originating IP address(es)</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ip</span><span class="p">.</span><span class="n">src</span> <span class="o">==</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span>
</code></pre></div></div>

<ul>
  <li><strong>Filtering based on host and port</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ip</span><span class="p">.</span><span class="n">host</span> <span class="o">==</span> <span class="n">www</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
</code></pre></div></div>

<h2 id="ftp-packet-analysis">FTP Packet Analysis</h2>

<p>Now that the basics of Wireshark is done, let’s start with the hands-on. We will be examining a <a href="https://github.com/xmehulx/wireshark-samples/raw/master/ftp_20-21.pcap">Wireshark capture</a> between my system and a remote system with FTP service enabled. (You can download this packet capture if you want to).</p>

<p><code class="language-plaintext info highlighter-rouge">Note</code></p>
<blockquote>
  <p>This is an active FTP session (not passive) and passive FTP session would be covered later.</p>
</blockquote>

<p>The FTP session conversation was this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">ftp</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span>
<span class="n">Connected</span> <span class="n">to</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span><span class="p">.</span>
<span class="mi">220</span> <span class="p">(</span><span class="n">vsFTPd</span> <span class="mf">3.0</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span>
<span class="nc">Name </span><span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span><span class="p">:</span><span class="n">root</span><span class="p">):</span> <span class="n">ftpuser</span>
<span class="mi">331</span> <span class="n">Please</span> <span class="n">specify</span> <span class="n">the</span> <span class="n">password</span><span class="p">.</span>
<span class="n">Password</span><span class="p">:</span>
<span class="mi">230</span> <span class="n">Login</span> <span class="n">successful</span><span class="p">.</span>
<span class="n">Remote</span> <span class="n">system</span> <span class="nb">type</span> <span class="ow">is</span> <span class="n">UNIX</span><span class="p">.</span>
<span class="n">Using</span> <span class="n">binary</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">transfer</span> <span class="n">files</span><span class="p">.</span>
<span class="n">ftp</span><span class="o">&gt;</span> <span class="n">ls</span>
<span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
<span class="mi">150</span> <span class="n">Here</span> <span class="n">comes</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">listing</span><span class="p">.</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>    <span class="mi">1</span> <span class="mi">0</span>        <span class="mi">0</span>            <span class="mi">3405</span> <span class="n">Dec</span> <span class="mi">02</span>  <span class="mi">2019</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>    <span class="mi">1</span> <span class="mi">0</span>        <span class="mi">0</span>         <span class="mi">5270987</span> <span class="n">Dec</span> <span class="mi">03</span>  <span class="mi">2019</span> <span class="n">html</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
<span class="mi">226</span> <span class="n">Directory</span> <span class="n">send</span> <span class="n">OK</span><span class="p">.</span>
<span class="n">ftp</span><span class="o">&gt;</span> <span class="n">mget</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
<span class="n">mget</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="err">?</span> <span class="n">yes</span>
<span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
<span class="mi">150</span> <span class="n">Opening</span> <span class="n">BINARY</span> <span class="n">mode</span> <span class="n">data</span> <span class="n">connection</span> <span class="k">for</span> <span class="n">dump</span><span class="p">.</span><span class="nf">sql </span><span class="p">(</span><span class="mi">3405</span> <span class="nb">bytes</span><span class="p">).</span>
<span class="mi">226</span> <span class="n">Transfer</span> <span class="n">complete</span><span class="p">.</span>
<span class="mi">3405</span> <span class="nb">bytes</span> <span class="n">received</span> <span class="ow">in</span> <span class="mf">0.00</span> <span class="nf">secs </span><span class="p">(</span><span class="mf">16.1555</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>
<span class="n">ftp</span><span class="o">&gt;</span> <span class="n">quit</span>
<span class="mi">221</span> <span class="n">Goodbye</span><span class="p">.</span>
</code></pre></div></div>

<p>And the packet log is shown below</p>

<p><img src="/assets/images/articles/cap1.png" alt="Wireshark Capture" /></p>

<p>So let’s go over each and every command and see what’s happening. The client IP in this case was <strong>10.10.15.211</strong> and the FTP server was hosted on the machine with IP <strong>10.10.10.187</strong></p>

<h3 id="tcp-handshake">TCP Handshake</h3>

<p>When we type in the command <code class="language-plaintext highlighter-rouge">ftp 10.10.10.187</code> we are immediately shown the following output:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">ftp</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span>
<span class="n">Connected</span> <span class="n">to</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span><span class="p">.</span>
<span class="mi">220</span> <span class="p">(</span><span class="n">vsFTPd</span> <span class="mf">3.0</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<p>It shows “connected”, but before any TCP connection is established, a 3-way handshake was performed as it can be seen with the captured packets.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="mi">1</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64240</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745094911</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
  <span class="mi">2</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">28960</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3049545</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745094911</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
  <span class="mi">3</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745095573</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3049545</span>
  <span class="mi">4</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">72</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">220</span> <span class="p">(</span><span class="n">vsFTPd</span> <span class="mf">3.0</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span>
  <span class="mi">5</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">21</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745096034</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3049709</span>
</code></pre></div></div>

<p>The first three packets of the capture is the 3-way handhshake, highlighted with grey in Wireshark, which can be seen with the <code class="language-plaintext highlighter-rouge">tshark</code> output above. The fourth packet is the FTP banner sent by the remote server and the fifth is the acknowledgment of the previous packet. This can be summarized with the following sequence diagram.</p>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  A-&gt;&gt;F: TCP [SYN]
  F--&gt;&gt;A: TCP [SYN, ACK]
  A-&gt;&gt;F: TCP [ACK]
  Note over A,F: Connection Established
  F--&gt;&gt;A: FTP [Response: 220]
  A-&gt;&gt;F: TCP [ACK]
</code></pre>

<p>and this is the output in the terminal when the connection has been established</p>

<h3 id="login-credentials">Login Credentials</h3>

<p>When the connection has been established, The FTP asks for username and password:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Name </span><span class="p">(</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span><span class="p">:</span><span class="n">root</span><span class="p">):</span> <span class="n">ftpuser</span>
<span class="mi">331</span> <span class="n">Please</span> <span class="n">specify</span> <span class="n">the</span> <span class="n">password</span><span class="p">.</span>
<span class="n">Password</span><span class="p">:</span>
</code></pre></div></div>

<p>And the corresponding packets for this interaction were…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="mi">6</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">66</span> <span class="n">Request</span><span class="p">:</span> <span class="n">USER</span> <span class="n">ftpuser</span>
  <span class="mi">7</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">21</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">15</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3050418</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745098416</span>
  <span class="mi">8</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">86</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">331</span> <span class="n">Please</span> <span class="n">specify</span> <span class="n">the</span> <span class="n">password</span><span class="p">.</span>
  <span class="mi">9</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">15</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">55</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745098626</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3050418</span>
 <span class="mi">10</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">72</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PASS</span> <span class="o">%</span><span class="n">n</span><span class="err">?</span><span class="mi">4</span><span class="n">Wz</span><span class="p">}</span><span class="n">R</span><span class="err">$</span><span class="n">tTF7</span>
 <span class="mi">11</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">55</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">35</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3050972</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745100590</span>
 <span class="mi">12</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">75</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">230</span> <span class="n">Login</span> <span class="n">successful</span><span class="p">.</span>
 <span class="mi">13</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">35</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">78</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745100863</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3050978</span>
</code></pre></div></div>

<p>From the above output we can formulate the given sequence diagram for the packet flow.</p>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  A-&gt;&gt;F: FTP [Request: USER]
  F--&gt;&gt;A: TCP [ACK]
  F--&gt;&gt;A: FTP [Response: 331]
  A-&gt;&gt;F: TCP [ACK]
  A-&gt;&gt;F: FTP [Request: PASS]
  F--&gt;&gt;A: TCP [ACK]
  Note over A,F: User Authorized
  F--&gt;&gt;A: FTP [Response: 230]
  A-&gt;&gt;F: TCP [ACK]
</code></pre>

<p>And once authorized, our system issued a <code class="language-plaintext highlighter-rouge">SYST</code> command to ask the system type of the remote server.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Remote</span> <span class="n">system</span> <span class="nb">type</span> <span class="ow">is</span> <span class="n">UNIX</span><span class="p">.</span>
<span class="n">Using</span> <span class="n">binary</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">transfer</span> <span class="n">files</span><span class="p">.</span>
</code></pre></div></div>

<p>We couldn’t have known this if we didn’t see the packets being transferred, and the packets that gave this output were:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">14</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">58</span> <span class="n">Request</span><span class="p">:</span> <span class="n">SYST</span>
 <span class="mi">15</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">78</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">41</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051023</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745100864</span>
 <span class="mi">16</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">71</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">215</span> <span class="n">UNIX</span> <span class="n">Type</span><span class="p">:</span> <span class="n">L8</span>
 <span class="mi">17</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">41</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">97</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745101404</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051023</span>
</code></pre></div></div>

<p>To represent it in a sequence diagram…</p>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  A-&gt;&gt;F: FTP [Request: SYST]
  F--&gt;&gt;A: TCP [ACK]
  F--&gt;&gt;A: FTP [Response: 215]
  A-&gt;&gt;F: TCP [ACK]
</code></pre>

<h3 id="directory-listing">Directory Listing</h3>

<p>After being authorized, I performed the simplest command, that is <code class="language-plaintext highlighter-rouge">ls</code> which gave the following output:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ftp</span><span class="o">&gt;</span> <span class="n">ls</span>
<span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
<span class="mi">150</span> <span class="n">Here</span> <span class="n">comes</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">listing</span><span class="p">.</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>    <span class="mi">1</span> <span class="mi">0</span>        <span class="mi">0</span>            <span class="mi">3405</span> <span class="n">Dec</span> <span class="mi">02</span>  <span class="mi">2019</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>    <span class="mi">1</span> <span class="mi">0</span>        <span class="mi">0</span>         <span class="mi">5270987</span> <span class="n">Dec</span> <span class="mi">03</span>  <span class="mi">2019</span> <span class="n">html</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
<span class="mi">226</span> <span class="n">Directory</span> <span class="n">send</span> <span class="n">OK</span><span class="p">.</span>
</code></pre></div></div>

<p>Surprisingly, behind such a simple command, a series of packets are transferred:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">18</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">79</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PORT</span> <span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">158</span><span class="p">,</span><span class="mi">215</span>
 <span class="mi">19</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">103</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
 <span class="mi">20</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">68</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">148</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745103584</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051535</span>
 <span class="mi">21</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">58</span> <span class="n">Request</span><span class="p">:</span> <span class="n">LIST</span>
 <span class="mi">22</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29200</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051710</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">23</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">40663</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65160</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104034</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051710</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">24</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">148</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">74</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051721</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745103584</span>
 <span class="mi">25</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051815</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745104034</span>
 <span class="mi">26</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">91</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">150</span> <span class="n">Here</span> <span class="n">comes</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">listing</span><span class="p">.</span>
 <span class="mi">27</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">74</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">187</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104213</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051815</span>
 <span class="mi">28</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">187</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">135</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">LIST</span><span class="p">)</span>
 <span class="mi">29</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">40663</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">136</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104213</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051815</span>
 <span class="mi">30</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">136</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051815</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745104034</span>
 <span class="mi">31</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">40663</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">137</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104214</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051815</span>
 <span class="mi">32</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">76</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">226</span> <span class="n">Directory</span> <span class="n">send</span> <span class="n">OK</span><span class="p">.</span>
 <span class="mi">33</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">74</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">211</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104673</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051863</span>
 <span class="mi">34</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">137</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051863</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745104214</span>
</code></pre></div></div>

<p>So let’s go over the packets one by one:</p>
<ol>
  <li>Initially, the client issues a <code class="language-plaintext highlighter-rouge">PORT</code> command used to initiate a data connection to transfer data. The command include information on the address and port the server should use to connect back to the client. The structure of data is: <strong>PORT (x1,x2,x3,x4,p1,p2)</strong>, where the address where the server should respond to is <strong>x1.x2.x3.x4</strong> and the port should be <strong>(p1 x 256) + p2</strong>. In this case the the address is <strong>10.10.15.211</strong> and port is (158 x 256) + 215 = <strong>40663</strong>.</li>
  <li>The client then issues a <code class="language-plaintext highlighter-rouge">LIST</code> command to get the list of files and directories.</li>
  <li>Then, the server connects to the above mentioned port (usually from port 20) to initiate data tranfer.</li>
  <li>Once the data is transferred, the connection is closed to the data stream.</li>
</ol>

<p>So, to understand it better, we’ll be dividing it into two different diagrams. One, the formalities that need to be done to initiate the transfer and second, the data transfer itself.</p>

<p>First, the formalities:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">18</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">79</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PORT</span> <span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">158</span><span class="p">,</span><span class="mi">215</span>
 <span class="mi">19</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">103</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
 <span class="mi">20</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">68</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">148</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745103584</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051535</span>
 <span class="mi">21</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">58</span> <span class="n">Request</span><span class="p">:</span> <span class="n">LIST</span>
 <span class="mi">24</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">148</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">74</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051721</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745103584</span>
 <span class="mi">26</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">91</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">150</span> <span class="n">Here</span> <span class="n">comes</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">listing</span><span class="p">.</span>
 <span class="mi">27</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">74</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">187</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104213</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051815</span>
 <span class="mi">32</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">76</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">226</span> <span class="n">Directory</span> <span class="n">send</span> <span class="n">OK</span><span class="p">.</span>
 <span class="mi">33</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">74</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">211</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104673</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051863</span>
</code></pre></div></div>
<p>And its corresponding sequence diagram</p>
<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  A-&gt;&gt;F:  FTP [Request: PORT]
  F--&gt;&gt;A: FTP [Response: 200]
  A-&gt;&gt;F:  TCP [ACK]
  A-&gt;&gt;F:  FTP [Request: LIST]
  Note over A,F: Establ. connection for data tranfer
  F--&gt;&gt;A: TCP [ACK]
  F--&gt;&gt;A: FTP [Response: 150]
  A-&gt;&gt;F:  TCP [ACK]
  Note over A,F: Tranferring data between new ports
  F--&gt;&gt;A: FTP [Response: 226]
  A-&gt;&gt;F: TCP [ACK]
</code></pre>

<p>Then, the data transfer:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">22</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29200</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051710</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">23</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">40663</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65160</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104034</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051710</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">25</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051815</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745104034</span>
 <span class="mi">28</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">187</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">135</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">LIST</span><span class="p">)</span>
 <span class="mi">29</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">40663</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">136</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104213</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051815</span>
 <span class="mi">30</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">136</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051815</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745104034</span>
 <span class="mi">31</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">40663</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">137</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745104214</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3051815</span>
 <span class="mi">34</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">40663</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">137</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3051863</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745104214</span>
</code></pre></div></div>
<p>and its corresponding sequence diagram</p>
<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  F--&gt;&gt;A: TCP [SYN]
  A-&gt;&gt;F:  TCP [SYN, ACK]
  F--&gt;&gt;A: TCP [ACK]
  Note over A,F: Connection established
  F--&gt;&gt;A: FTP-DATA
  A-&gt;&gt;F:  TCP [ACK]
  F--&gt;&gt;A: TCP [FIN, ACK]
  A-&gt;&gt;F:  TCP [FIN, ACK]
  F--&gt;&gt;A: TCP [ACK]
  Note over A,F: Connection closed 
</code></pre>

<p>All this was happening just to display the contents of a folder!</p>

<p><code class="language-plaintext info highlighter-rouge">Note</code></p>
<blockquote>
  <p>From now on, I would simply be using <strong>“Connection established”</strong> and <strong>“Connection closed”</strong> for the 3-way handshake</p>
</blockquote>

<h3 id="file-download">File Download</h3>

<p>After listing the directory contents, I downloaded the file named <strong>dump.sql</strong> using the command <code class="language-plaintext highlighter-rouge">mget</code> (I know I could have used <code class="language-plaintext highlighter-rouge">get</code> but it’s a habit now to use <code class="language-plaintext highlighter-rouge">mget</code> all the time):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ftp</span><span class="o">&gt;</span> <span class="n">mget</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
<span class="n">mget</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="err">?</span> <span class="n">yes</span>
<span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
<span class="mi">150</span> <span class="n">Opening</span> <span class="n">BINARY</span> <span class="n">mode</span> <span class="n">data</span> <span class="n">connection</span> <span class="k">for</span> <span class="n">dump</span><span class="p">.</span><span class="nf">sql </span><span class="p">(</span><span class="mi">3405</span> <span class="nb">bytes</span><span class="p">).</span>
<span class="mi">226</span> <span class="n">Transfer</span> <span class="n">complete</span><span class="p">.</span>
<span class="mi">3405</span> <span class="nb">bytes</span> <span class="n">received</span> <span class="ow">in</span> <span class="mf">0.00</span> <span class="nf">secs </span><span class="p">(</span><span class="mf">16.1555</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>
</code></pre></div></div>

<p>And the corresponding packets for this were:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">35</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">79</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PORT</span> <span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">172</span><span class="p">,</span><span class="mi">161</span>                                                                                                   
 <span class="mi">36</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">211</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">101</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053605</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111165</span>                                                      
 <span class="mi">37</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">103</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>                                                                         
 <span class="mi">38</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">101</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">262</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745111393</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053605</span>                                                      
 <span class="mi">39</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">67</span> <span class="n">Request</span><span class="p">:</span> <span class="n">NLST</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>                                                                                                               
 <span class="mi">40</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29200</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053655</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>                                             
 <span class="mi">41</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">44193</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65160</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745111712</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053655</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>                         
 <span class="mi">42</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">262</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">116</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053666</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111393</span>                                                      
 <span class="mi">43</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053738</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111712</span>                                                          
 <span class="mi">44</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">91</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">150</span> <span class="n">Here</span> <span class="n">comes</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">listing</span><span class="p">.</span>                                                                                      
 <span class="mi">45</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">62</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">10</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">NLST</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span> 
 <span class="mi">46</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">44193</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">11</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112099</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053738</span>
 <span class="mi">47</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">11</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053738</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111712</span>
 <span class="mi">48</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">44193</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">12</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112099</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053738</span>
 <span class="mi">49</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">116</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">301</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112139</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053738</span>
 <span class="mi">50</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">12</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053833</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745112099</span>
 <span class="mi">51</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">76</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">226</span> <span class="n">Directory</span> <span class="n">send</span> <span class="n">OK</span><span class="p">.</span>
 <span class="mi">52</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">116</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">325</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112284</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053833</span>
 <span class="mi">53</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">60</span> <span class="n">Request</span><span class="p">:</span> <span class="n">TYPE</span> <span class="n">I</span>
 <span class="mi">54</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">325</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">124</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054339</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745114086</span>
 <span class="mi">55</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">83</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">Switching</span> <span class="n">to</span> <span class="n">Binary</span> <span class="n">mode</span><span class="p">.</span>
 <span class="mi">56</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">124</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">356</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745114308</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054339</span>
 <span class="mi">57</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">79</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PORT</span> <span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">145</span>
 <span class="mi">58</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">103</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
 <span class="mi">59</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">151</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">407</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745114486</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054383</span>
 <span class="mi">60</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">67</span> <span class="n">Request</span><span class="p">:</span> <span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
 <span class="mi">61</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29200</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054429</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">62</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65160</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115099</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054429</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">63</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">407</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">166</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054440</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745114486</span>
 <span class="mi">64</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054586</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745115099</span>
 <span class="mi">65</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">120</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">150</span> <span class="n">Opening</span> <span class="n">BINARY</span> <span class="n">mode</span> <span class="n">data</span> <span class="n">connection</span> <span class="k">for</span> <span class="n">dump</span><span class="p">.</span><span class="nf">sql </span><span class="p">(</span><span class="mi">3405</span> <span class="nb">bytes</span><span class="p">).</span>
 <span class="mi">66</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">166</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">475</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115554</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">67</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">1397</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">1345</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">68</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1346</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64128</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115555</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">69</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">1397</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">1345</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">70</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2691</span> <span class="n">Win</span><span class="o">=</span><span class="mi">63232</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115555</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">71</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">767</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">715</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">72</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">3406</span> <span class="n">Win</span><span class="o">=</span><span class="mi">62592</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115555</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">73</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">3406</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054586</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745115099</span>
 <span class="mi">74</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">3407</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64128</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115556</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">75</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">3407</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054695</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745115556</span>
 <span class="mi">76</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">76</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">226</span> <span class="n">Transfer</span> <span class="n">complete</span><span class="p">.</span>
 <span class="mi">77</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">166</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">499</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745116090</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054695</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">mget</code> command too invokes series of different commands to download a file, which are:</p>

<ol>
  <li><strong>PORT</strong> command to open new connection for data transfer to list the file name.</li>
  <li><strong>NLST</strong> command to list the file.</li>
  <li><strong>TYPE</strong> command to change the transfer type (in this case into binary).</li>
  <li><strong>PORT</strong> command again for data transfer. This time to transfer file contents.</li>
  <li><strong>RETR</strong> command to get the file contents.</li>
</ol>

<p>Let’s look at each one of them, starting from outermost:</p>

<p><strong>1. The Invoking of Requests</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">35</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">79</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PORT</span> <span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">172</span><span class="p">,</span><span class="mi">161</span>
 <span class="mi">36</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">211</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">101</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053605</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111165</span>
 <span class="mi">37</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">103</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
 <span class="mi">38</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">101</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">262</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745111393</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053605</span>
 <span class="mi">39</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">67</span> <span class="n">Request</span><span class="p">:</span> <span class="n">NLST</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
 <span class="mi">42</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">262</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">116</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053666</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111393</span>
 <span class="mi">44</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">91</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">150</span> <span class="n">Here</span> <span class="n">comes</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">listing</span><span class="p">.</span>
 <span class="mi">49</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">116</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">301</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112139</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053738</span>
 <span class="mi">51</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">76</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">226</span> <span class="n">Directory</span> <span class="n">send</span> <span class="n">OK</span><span class="p">.</span>
 <span class="mi">52</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">116</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">325</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112284</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053833</span>
 <span class="mi">53</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">60</span> <span class="n">Request</span><span class="p">:</span> <span class="n">TYPE</span> <span class="n">I</span>
 <span class="mi">54</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">325</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">124</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054339</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745114086</span>
 <span class="mi">55</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">83</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">Switching</span> <span class="n">to</span> <span class="n">Binary</span> <span class="n">mode</span><span class="p">.</span>
 <span class="mi">56</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">124</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">356</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745114308</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054339</span>
 <span class="mi">57</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">79</span> <span class="n">Request</span><span class="p">:</span> <span class="n">PORT</span> <span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">145</span>
 <span class="mi">58</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">103</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">using</span> <span class="n">PASV</span><span class="p">.</span>
 <span class="mi">59</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">151</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">407</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745114486</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054383</span>
 <span class="mi">60</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">67</span> <span class="n">Request</span><span class="p">:</span> <span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span>
 <span class="mi">63</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">407</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">166</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054440</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745114486</span>
 <span class="mi">65</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">120</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">150</span> <span class="n">Opening</span> <span class="n">BINARY</span> <span class="n">mode</span> <span class="n">data</span> <span class="n">connection</span> <span class="k">for</span> <span class="n">dump</span><span class="p">.</span><span class="nf">sql </span><span class="p">(</span><span class="mi">3405</span> <span class="nb">bytes</span><span class="p">).</span>
 <span class="mi">66</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">166</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">475</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115554</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">76</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">76</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">226</span> <span class="n">Transfer</span> <span class="n">complete</span><span class="p">.</span>
 <span class="mi">77</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">166</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">499</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745116090</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054695</span>
</code></pre></div></div>

<p>Which could be easily understood by:</p>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  A-&gt;&gt;F: FTP [Request: PORT]
  F--&gt;&gt;A:TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 200]
  A-&gt;&gt;F: TCP [ACK]
  A-&gt;&gt;F: FTP [Request: NLST]
  Note over A,F: Connection for directory listing
  F--&gt;&gt;A:TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 150]
  Note over A,F: Transferring file list
  A-&gt;&gt;F: TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 226]
  A-&gt;&gt;F: TCP [ACK]
  A-&gt;&gt;F: FTP [Request: TYPE]
  F--&gt;&gt;A:TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 200]
  A-&gt;&gt;F: TCP [ACK]
  A-&gt;&gt;F: FTP [Request: PORT]
  F--&gt;&gt;A:TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 200]
  A-&gt;&gt;F: TCP [ACK]
  A-&gt;&gt;F: FTP [Request: RETR]
  Note over A,F: Connection for file transfer
  F--&gt;&gt;A:TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 150]
  A-&gt;&gt;F: TCP [ACK]
  Note over A,F: Transferring file content
  F--&gt;&gt;A:FTP [Response: 226]
  A-&gt;&gt;F: TCP [ACK]
</code></pre>

<ul>
  <li><strong>NLST over PORT</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">40</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29200</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053655</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">41</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">44193</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65160</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745111712</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053655</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">43</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053738</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111712</span>
 <span class="mi">45</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">62</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">10</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">NLST</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">46</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">44193</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">11</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112099</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053738</span>
 <span class="mi">47</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">11</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053738</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745111712</span>
 <span class="mi">48</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">44193</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">12</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65152</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745112099</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3053738</span>
 <span class="mi">50</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">44193</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">12</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3053833</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745112099</span>
</code></pre></div></div>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  Note over A,F: Connection Established
  F--&gt;&gt;A:FTP-DATA
  A-&gt;&gt;F: TCP [ACK]
  Note over A,F: Connection Closed
</code></pre>

<ul>
  <li><strong>RETR over PORT</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">61</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">SYN</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29200</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1357</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054429</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">0</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">62</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">60</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">SYN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">65160</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">MSS</span><span class="o">=</span><span class="mi">1460</span> <span class="n">SACK_PERM</span><span class="o">=</span><span class="mi">1</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115099</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054429</span> <span class="n">WS</span><span class="o">=</span><span class="mi">128</span>
 <span class="mi">64</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054586</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745115099</span>
 <span class="mi">67</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">1397</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">1345</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">68</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1346</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64128</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115555</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">69</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">1397</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">1345</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">70</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2691</span> <span class="n">Win</span><span class="o">=</span><span class="mi">63232</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115555</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">71</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span><span class="o">-</span><span class="n">DATA</span> <span class="mi">767</span> <span class="n">FTP</span> <span class="n">Data</span><span class="p">:</span> <span class="mi">715</span> <span class="nf">bytes </span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span> <span class="p">(</span><span class="n">RETR</span> <span class="n">dump</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span>
 <span class="mi">72</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">3406</span> <span class="n">Win</span><span class="o">=</span><span class="mi">62592</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115555</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">73</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">3406</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">1</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054586</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745115099</span>
 <span class="mi">74</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">38545</span> <span class="err">→</span> <span class="mi">20</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">3407</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64128</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745115556</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3054586</span>
 <span class="mi">75</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">20</span> <span class="err">→</span> <span class="mi">38545</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">3407</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">2</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29312</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3054695</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745115556</span>
</code></pre></div></div>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  Note over A,F: Connection Established
  F--&gt;&gt;A:FTP-DATA
  A-&gt;&gt;F: TCP [ACK]
  F--&gt;&gt;A:FTP-DATA
  A-&gt;&gt;F: TCP [ACK]
  F--&gt;&gt;A:FTP-DATA
  A-&gt;&gt;F: TCP [ACK]
  Note over A,F: Connection Closed
</code></pre>

<h3 id="closing-session">Closing Session</h3>

<p>After all this, all that is left is to quit the FTP session</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ftp</span><span class="o">&gt;</span> <span class="n">quit</span>
<span class="mi">221</span> <span class="n">Goodbye</span><span class="p">.</span>
</code></pre></div></div>

<p>And the packets this command generated were:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="mi">78</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">FTP</span> <span class="mi">58</span> <span class="n">Request</span><span class="p">:</span> <span class="n">QUIT</span>
 <span class="mi">79</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">499</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">172</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3055803</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745119944</span>
 <span class="mi">80</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">FTP</span> <span class="mi">66</span> <span class="n">Response</span><span class="p">:</span> <span class="mi">221</span> <span class="n">Goodbye</span><span class="p">.</span>
 <span class="mi">81</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">172</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">513</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745120354</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3055803</span>
 <span class="mi">82</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">513</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">172</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3055803</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745119944</span>
 <span class="mi">83</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">47050</span> <span class="err">→</span> <span class="mi">21</span> <span class="p">[</span><span class="n">FIN</span><span class="p">,</span> <span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">172</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">514</span> <span class="n">Win</span><span class="o">=</span><span class="mi">64256</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3745120355</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3055803</span>
 <span class="mi">84</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.187</span> <span class="err">→</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">15.211</span> <span class="n">TCP</span> <span class="mi">52</span> <span class="mi">21</span> <span class="err">→</span> <span class="mi">47050</span> <span class="p">[</span><span class="n">ACK</span><span class="p">]</span> <span class="n">Seq</span><span class="o">=</span><span class="mi">514</span> <span class="n">Ack</span><span class="o">=</span><span class="mi">173</span> <span class="n">Win</span><span class="o">=</span><span class="mi">29056</span> <span class="n">Len</span><span class="o">=</span><span class="mi">0</span> <span class="n">TSval</span><span class="o">=</span><span class="mi">3055895</span> <span class="n">TSecr</span><span class="o">=</span><span class="mi">3745120355</span>
</code></pre></div></div>

<p>Which should be fairly easy to understand now, after looking at all these sequence diagrams.</p>

<pre><code class="language-mermaid">sequenceDiagram
  participant A as Client
  participant F as FTP Server
  A-&gt;&gt;F: FTP [Request: QUIT]
  F--&gt;&gt;A:TCP [ACK]
  F--&gt;&gt;A:FTP [Response: 221]
  A-&gt;&gt;F: TCP [ACK]
  Note over A,F: Connection Closed
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>That would be a lot to take in for a newbie, but if they have strong understanding of TCP/IP protocol and its model, this would still be quite easy to grasp. Understanding the packet structure and the working of Wireshark would make the life of a security engineer a lot easier as they would know what each and every packet is doing in their network.</p>

<!--more-->

<hr />

</div><section class="article__sharing d-print-none"></section><div class="d-print-none"><footer class="article__footer"><meta itemprop="dateModified" content="2020-07-08T00:00:00+05:30"><!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div itemscope itemtype="http://schema.org/Person" class="author-profile card card--flat item"><a href="https://mehulsingh.com" class="item__image"><img class="author-profile__avatar" itemprop="image" src="https://xmehulx.github.io/assets/img/me.jpg" /></a><div class="item__content"><meta itemprop="name" content="Mehul Singh">
        <p class="author-profile__name"><meta itemprop="url" content="https://mehulsingh.com">
            <a href="https://mehulsingh.com">Mehul Singh</a></p><p itemprop="description">A graduate student working on his red-teaming journey.</p>
    </div>
</div>
<div class="article__subscribe"><div class="subscribe"><i class="fas fa-rss"></i> <a type="application/rss+xml" href="/feed.xml">Subscribe</a></div>
</div><div class="article__license">
</div></footer>
<div class="article__section-navigator clearfix"><div class="previous"><span>PREVIOUS</span><a href="/beginners-guide-to-awk">Beginner's Guide to AWK</a></div><div class="next"><span>NEXT</span><a href="/Regression">RegreSSHion? Technical analysis of CVE-2024-6387</a></div></div></div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mehul Singh"><meta itemprop="url" content="https://mehulsingh.com"><meta itemprop="description" content="Mehul is an Graduate student with experience as a GRC advisor and who is working towards his expertise in red-teaming."><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><link itemprop="url" href="https://mehulsingh.com"><li title="Follow Mehul on Twitter.">
        <a class="button button--circle twitter-button" itemprop="sameAs" href="https://x.com/0x__shell" target="_blank">
          <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 72 72" viewBox="0 0 72 72" id="twitter-x">
  <switch>
    <g>
      <path d="M42.5,31.2L66,6h-6L39.8,27.6L24,6H4l24.6,33.6L4,66
			h6l21.3-22.8L48,66h20L42.5,31.2z M12.9,10h8l38.1,52h-8L12.9,10z"></path>
    </g>
  </switch>
</svg>
</div>
        </a>
      </li><li title="Follow Mehul on Linkedin.">
        <a class="button button--circle linkedin-button" itemprop="sameAs" href="https://www.linkedin.com/in/mehul-singh-0x00" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M260.096 155.648c0 27.307008-9.899008 50.516992-29.696 69.632-19.796992 19.115008-45.396992 28.672-76.8 28.672-30.036992 0-54.612992-9.556992-73.728-28.672-19.115008-19.115008-28.672-42.324992-28.672-69.632 0-28.672 9.556992-52.224 28.672-70.656 19.115008-18.432 44.372992-27.648 75.776-27.648 31.403008 0 56.32 9.216 74.752 27.648 18.432 18.432 28.331008 41.984 29.696 70.656 0 0 0 0 0 0m-202.752 808.96c0 0 0-632.832 0-632.832 0 0 196.608 0 196.608 0 0 0 0 632.832 0 632.832 0 0-196.608 0-196.608 0 0 0 0 0 0 0m313.344-430.08c0-58.708992-1.364992-126.292992-4.096-202.752 0 0 169.984 0 169.984 0 0 0 10.24 88.064 10.24 88.064 0 0 4.096 0 4.096 0 40.96-68.267008 105.812992-102.4 194.56-102.4 68.267008 0 123.220992 22.868992 164.864 68.608 41.643008 45.739008 62.464 113.664 62.464 203.776 0 0 0 374.784 0 374.784 0 0-196.608 0-196.608 0 0 0 0-350.208 0-350.208 0-91.476992-33.451008-137.216-100.352-137.216-47.787008 0-81.236992 24.576-100.352 73.728-4.096 8.192-6.144 24.576-6.144 49.152 0 0 0 364.544 0 364.544 0 0-198.656 0-198.656 0 0 0 0-430.08 0-430.08 0 0 0 0 0 0" />
</svg>
</div>
        </a>
      </li><li title="Follow Mehul on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/xmehulx" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z" />
</svg>
</div>
        </a>
      </li></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>Kindly buy Mehul a <a title="This will really help in his certifications" href="http://buymeacoffee.com/xmehulx">cup of coffee</a>
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"><script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text" />
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script><script type="text/x-mathjax-config">
	var _config = { tex2jax: {
		inlineMath: [['$','$'], ['\\(','\\)']]
	}};MathJax.Hub.Config(_config);
</script>
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  window.Lazyload.js('https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js', function() {
    mermaid.initialize({
      startOnLoad: true
    });
    mermaid.init(undefined, '.language-mermaid');
  });
</script>

    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

